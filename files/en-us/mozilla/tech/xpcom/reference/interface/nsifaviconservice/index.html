---
title: nsIFaviconService
slug: Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService
tags:
  - Interfaces
  - 'Interfaces:Scriptable'
  - Places
  - XPCOM
  - XPCOM API Reference
  - XPCOM Interface Reference
---
<p></p><div style="border: solid #ddd 2px; margin-bottom: 12px;">
<div style="background: #eee; padding: 2px;"><code><a href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/places/public/nsIFaviconService.idl" rel="custom">toolkit/components/places/public/nsIFaviconService.idl</a></code><span style="text-align: right; float: right;"><a href="/en-US/docs/Interfaces/About_Scriptable_Interfaces" style="color: #00cc00; font-weight: 700;">Scriptable</a></span></div>
<span style="padding: 4px 2px;">

Stores favicons for pages in bookmarks and history.
</span>

  <div style="height: 42px; position: relative; padding: 2px; width: auto;">

  <div style="top: 22px; font-size: 11px; position: absolute;">1.0</div>

  <div style="top: 22px; font-size: 11px; position: absolute; left: 0px; text-align: right; float: right; width: 100%;">66</div>

  <div style="height: 8px; top: 16px; background: #dd0000; left: 0px; position: absolute; width: 5.714285714285714%;"></div>

<div style="height: 8px; top: 16px; left: 5.714285714285714%; background: #00dd00; position: absolute; width: 94.28571428571429%;" title="Introduced in Gecko 1.8 (Firefox 1.5 / Thunderbird 1.5 / SeaMonkey 1.0)"></div>

<div style="top: 0px; font-size: 11px; position: absolute; left: 5.714285714285714%;">Introduced</div>
<div style="top: 22px; font-size: 11px; position: absolute; left: 5.714285714285714%;">Gecko 1.8</div>

    <div style="height: 8px; top: 16px; left: 36.642857142857146%; background: #eeee00; position: absolute; width: 1%; border-radius: 4px; -webkit-border-radius: 4px;" title="Last changed in Gecko 22.0 (Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)"></div>

</div>

<div style="background: #eee; padding: 2px;">
Inherits from: <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsISupports" title>nsISupports</a></code>
<span style="text-align: right; float: right;">Last changed in Gecko 22.0 (Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)</span></div>
</div><p></p>
<p>Implemented by: <code>@mozilla.org/browser/favicon-service;1</code>. To use this service, use:</p>
<pre class="eval">var faviconService = Components.classes[&quot;@mozilla.org/browser/favicon-service;1&quot;]
                     .getService(Components.interfaces.nsIFaviconService);
</pre>
<h2 id="Method_overview" name="Method_overview">Method overview</h2>
<table class="standard-table">
 <tbody>
  <tr>
   <td><code>void <a href="#addFailedFavicon()">addFailedFavicon</a>(in nsIURI aFaviconURI);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#expireAllFavicons()">expireAllFavicons</a>();</code> </td>
  </tr>
  <tr>
   <td><code>void <a href="#getFaviconData()">getFaviconData</a>(in nsIURI aFaviconURI, out AUTF8String aMimeType, [optional] out unsigned long aDataLen, [array,retval,size_is(aDataLen)] out octet aData);</code> <span class="obsolete obsoleteInline notecard inline" title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Obsolete since Gecko 22.0</span></td>
  </tr>
  <tr>
   <td><code>AString <a href="#getFaviconDataAsDataURL()">getFaviconDataAsDataURL</a>(in nsIURI aFaviconURI);</code>  <span class="obsolete obsoleteInline notecard inline" title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Obsolete since Gecko 22.0</span></td>
  </tr>
  <tr>
   <td><code>nsIURI <a href="#getFaviconForPage()">getFaviconForPage</a>(in nsIURI aPageURI);</code> <span class="obsolete obsoleteInline notecard inline" title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Obsolete since Gecko 22.0</span></td>
  </tr>
  <tr>
   <td><code>nsIURI <a href="#getFaviconImageForPage()">getFaviconImageForPage</a>(in nsIURI aPageURI);</code> <span class="obsolete obsoleteInline notecard inline" title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Obsolete since Gecko 22.0</span></td>
  </tr>
  <tr>
   <td><code>nsIURI <a href="#getFaviconLinkForIcon()">getFaviconLinkForIcon</a>(in nsIURI aFaviconURI);</code></td>
  </tr>
  <tr>
   <td><code>boolean <a href="#isFailedFavicon()">isFailedFavicon</a>(in nsIURI aFaviconURI);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#removeFailedFavicon()">removeFailedFavicon</a>(in nsIURI aFaviconURI);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#setAndLoadFaviconForPage()">setAndLoadFaviconForPage</a>(in nsIURI aPageURI, in nsIURI aFaviconURI, in boolean aForceReload, in unsigned long aFaviconLoadType, [optional] in nsIFaviconDataCallback aCallback);</code> <span class="obsolete obsoleteInline notecard inline" title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Obsolete since Gecko 22.0</span></td>
  </tr>
  <tr>
   <td><code>void <a href="#setFaviconData()">setFaviconData</a>(in nsIURI aFaviconURI, [const,array,size_is(aDataLen)] in octet aData, in unsigned long aDataLen, in AUTF8String aMimeType, in PRTime aExpiration);</code> <span class="obsolete obsoleteInline notecard inline" title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Obsolete since Gecko 22.0</span></td>
  </tr>
  <tr>
   <td><code>void <a href="#setFaviconDataFromDataURL()">setFaviconDataFromDataURL</a>(in nsIURI aFaviconURI, in AString aDataURL, in PRTime aExpiration);</code>  <span class="obsolete obsoleteInline notecard inline" title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Obsolete since Gecko 22.0</span></td>
  </tr>
  <tr>
   <td><code>void <a href="#setFaviconUrlForPage()">setFaviconUrlForPage</a>(in nsIURI aPageURI, in nsIURI aFaviconURI);</code> <span class="obsolete obsoleteInline notecard inline" title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Obsolete since Gecko 22.0</span></td>
  </tr>
 </tbody>
</table>
<h2 id="Attributes" name="Attributes">Attributes</h2>
<table class="standard-table">
 <tbody>
  <tr>
   <td class="header">Attribute</td>
   <td class="header">Type</td>
   <td class="header">Description</td>
  </tr>
  <tr>
   <td><code>defaultFavicon</code></td>
   <td><code><code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIURI" title>nsIURI</a></code></code></td>
   <td>The default favicon URI. <strong>Read only.</strong> </td>
  </tr>
 </tbody>
</table>
<h2 id="Methods" name="Methods">Methods</h2>
<h3 id="addFailedFavicon()" name="addFailedFavicon()">addFailedFavicon()</h3>
<p>This method adds a given favicon&apos;s URI to the failed favicon cache.</p>
<p>The lifespan of the favicon cache is up to the caching system. This cache will also be written to if you use <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#setAndLoadFaviconForPage()">setAndLoadFaviconForPage()</a></code> method and it encounters an error while fetching an icon.</p>
<pre class="eval">void addFailedFavicon(
  in nsIURI aFaviconURI
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aFaviconURI</code></dt>
 <dd>
  The URI of an icon in the favicon service. Can be <code>null</code>.</dd>
</dl>
<p></p><h3 id="expireAllFavicons()">expireAllFavicons()</h3><p></p>
<p>Expires all known favicons, removing them from the database.</p>
<p></p><div class="note notecard"><strong>Note:</strong> This is an asynchronous operation; when it completes, a &quot;places-favicons-expired&quot; notification is dispatched through the observer&apos;s service.</div><p></p>
<pre class="eval">void expireAllFavicons();
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<p>None.</p>
<p></p><div class="headingWithIndicator">
        <h3 id="getFaviconData()">getFaviconData()</h3>
        <span class="obsolete obsoleteMethod notecard inline">Obsolete since Gecko 22.0 (Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)</span>
        </div><p></p>
<div class="note">
 <p><strong>Note:</strong> This method was removed in <span title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Gecko 22.0</span>. You should use the new async API <code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIAsyncFavicons#getFaviconDataForPage()">mozIAsyncFavicons.getFaviconDataForPage()</a></code> instead.</p>
</div>
<p>This method retrieves the given favicon data. Throws an exception if we don&apos;t have data.</p>
<p>If there is no data but we have an entry for this favicon, <code>aDataLen</code> will be <code>&quot;0&quot;</code> and <code>aData</code> will be <code>null</code>.</p>
<pre class="eval">void getFaviconData(
  in nsIURI aFaviconURI,
  out AUTF8String aMimeType,
  out unsigned long aDataLen, <span class="optional optionalInline notecard inline">Optional from Gecko 2.0</span>
  [array,retval,size_is(aDataLen)] out octet aData
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aFaviconURI</code></dt>
 <dd>
  URI of the favicon whose data is being read.</dd>
 <dt>
  <code>aMimeType</code></dt>
 <dd>
  Output parameter where the <code>MIME</code> type will be placed.</dd>
 <dt>
  <code>aDataLen</code></dt>
 <dd>
  Output parameter where the size of the binary data will be placed.</dd>
 <dt>
  <code>aData</code></dt>
 <dd>
  Output parameter where the binary favicon data will be placed. This will be <code>null</code> if we have this URI but have no data associated with it.</dd>
</dl>
<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>
<dl>
 <dt>
  <code>NS_ERROR_NOT_AVAILABLE</code></dt>
 <dd>
  Thrown when we have never heard of this favicon URL.</dd>
</dl>
<p></p><div class="headingWithIndicator">
        <h3 id="getFaviconDataAsDataURL()">getFaviconDataAsDataURL()</h3>
        <span class="obsolete obsoleteMethod notecard inline">Obsolete since Gecko 22.0 (Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)</span>
        </div><p></p>
<div class="note">
 <p><strong>Note:</strong> This method was removed in <span title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Gecko 22.0</span>. You should use the new async API <code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIAsyncFavicons#getFaviconDataForPage()">mozIAsyncFavicons.getFaviconDataForPage()</a></code> instead.</p>
</div>
<p>This method retrieves the given favicon data, returning it as a <code>data</code> URL Throws an exception if we don&apos;t have data.</p>
<p>If there is no data but we have an entry for this favicon, returns <code>null</code>.</p>
<pre class="eval">AString getFaviconDataAsDataURL(
  in nsIURI aFaviconURI
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aFaviconURI</code></dt>
 <dd>
  URI of the favicon whose data is being read.</dd>
</dl>
<h6 id="Return_value" name="Return_value">Return value</h6>
<p>A <code>data</code> URL containing the data for the favicon. This is <code>null</code> if there is no data but there is an entry for the favicon.</p>
<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>
<dl>
 <dt>
  <code>NS_ERROR_NOT_AVAILABLE</code></dt>
 <dd>
  Thrown when we have never heard of this favicon URL.</dd>
</dl>
<p></p><div class="headingWithIndicator">
        <h3 id="getFaviconForPage()">getFaviconForPage()</h3>
        <span class="obsolete obsoleteMethod notecard inline">Obsolete since Gecko 22.0 (Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)</span>
        </div><p></p>
<div class="note">
 <p><strong>Note:</strong> This method was removed in <span title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Gecko 22.0</span>. You should use the new async API <code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIAsyncFavicons#getFaviconURLForPage()">mozIAsyncFavicons.getFaviconURLForPage()</a></code> instead.</p>
</div>
<p>This method retrieves the URI of the favicon for the given page.</p>
<pre class="eval">nsIURI getFaviconForPage(
  in nsIURI aPageURI
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aPageURI</code></dt>
 <dd>
  URI of the page whose favicon is desired.</dd>
</dl>
<h6 id="Return_value" name="Return_value">Return value</h6>
<p>Returns the URI of the favicon associated with that page. Returning a URI here does NOT mean that we have data for this favicon, only that we know what the favicon should be.</p>
<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>
<dl>
 <dt>
  <code>NS_ERROR_NOT_AVAILABLE</code></dt>
 <dd>
  When the page is not found or it has no favicon.</dd>
</dl>
<p></p><div class="headingWithIndicator">
        <h3 id="getFaviconImageForPage()">getFaviconImageForPage()</h3>
        <span class="obsolete obsoleteMethod notecard inline">Obsolete since Gecko 22.0 (Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)</span>
        </div><p></p>
<div class="note">
 <p><strong>Note:</strong> This method was removed in <span title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Gecko 22.0</span>. You should use the new async API <code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIAsyncFavicons#getFaviconURLForPage()">mozIAsyncFavicons.getFaviconURLForPage()</a></code> and <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#getFaviconLinkForIcon()">getFaviconLinkForIcon()</a></code> instead.</p>
</div>
<p>This method is very similar to that of <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#getFaviconLinkForIcon()">getFaviconLinkForIcon()</a></code> method. For a given page will give you a URI that, when displayed in chrome, will result in the given page&apos;s favicon. Unlike the other get functions, we needn&apos;t have heard of the page or its favicon: the default one will be returned in this case.</p>
<p>When compared to <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#getFaviconLinkForIcon()">getFaviconLinkForIcon()</a></code> method, this method only adds the extra level of indirection, looking up the favicon based on the page URI and using the default if not found.</p>
<pre class="eval">nsIURI getFaviconImageForPage(
  in nsIURI aPageURI
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aPageURI</code></dt>
 <dd>
  URI of the page whose favicon is desired.</dd>
</dl>
<h6 id="Return_value" name="Return_value">Return value</h6>
<p>Returns a URI that will give you the icon image. This is <strong>not</strong> the URI of the icon as set on the page, but a URI that will give you the data out of the favicon service. For a normal page with a favicon we&apos;ve stored, this will be an annotation URI which will then cause the corresponding favicon data to be loaded from this service. For pages where we don&apos;t have a favicon, this will be a chrome URI of the default icon for a web page.</p>
<h3 id="getFaviconLinkForIcon()" name="getFaviconLinkForIcon()">getFaviconLinkForIcon()</h3>
<p>This method, for a given icon URI will return a URI that will result in the image. In most cases, this is an annotation URI. For chrome, this will do nothing and return the input URI.</p>
<p>No validity checking is done. If you pass an icon URI that we&apos;ve never seen, you&apos;ll get back a URI that references an invalid icon. The moz-anno protocol handler&apos;s special case for &quot;favicon&quot; annotations will resolve invalid icons to the default icon, although without caching. For invalid chrome URIs, you&apos;ll get a broken image.</p>
<pre class="eval">nsIURI getFaviconLinkForIcon(
  in nsIURI aFaviconURI
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aFaviconURI</code></dt>
 <dd>
  The URI of an icon in the favicon service.</dd>
</dl>
<h6 id="Return_value" name="Return_value">Return value</h6>
<p>Returns a URI that will load the desired icon. This is <strong>not</strong> the URI of the icon as set on the page, but a URI that will give you the data out of the favicon service. For a normal page with a favicon we&apos;ve stored, this will be an annotation URI which will then cause the corresponding favicon data to be loaded from this service. For pages where we don&apos;t have a favicon, this will be a chrome URI of the default icon for a web page. For chrome, the output will be the same as the input. For chrome, the output will be the same as the input.</p>
<p>No validity checking is done. If you pass an icon URI that we&apos;ve never seen, you&apos;ll get back a URI that references an invalid icon. The moz-anno protocol handler&apos;s special case for &quot;favicon&quot; annotations will detect most invalid icons and it will resolve to the default icon, although without caching. For invalid chrome URIs, you&apos;ll get a broken image.</p>
<h3 id="isFailedFavicon()" name="isFailedFavicon()">isFailedFavicon()</h3>
<p>This method checks to see if this favicon is in the failed favicon cache.</p>
<pre class="eval">boolean isFailedFavicon(
  in nsIURI aFaviconURI
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aFaviconURI</code></dt>
 <dd>
  The URI of an icon in the favicon service. Can be <code>null</code>.</dd>
</dl>
<h6 id="Return_value" name="Return_value">Return value</h6>
<p>Returns <code>true</code> if the favicon is in the failed cache, meaning you probably shouldn&apos;t try to load it. A <code>false</code> return value means that it&apos;s worth trying to load it. This allows you to avoid trying to load <code>&quot;foo.com/favicon.ico&quot;</code> for every page on a site that doesn&apos;t have a favicon.</p>
<h3 id="removeFailedFavicon()" name="removeFailedFavicon()">removeFailedFavicon()</h3>
<p>This method removes the given favicon from the failed favicon cache. If the icon is not in the cache, this function will silently succeed.</p>
<pre class="eval">void removeFailedFavicon(
  in nsIURI aFaviconURI
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aFaviconURI</code></dt>
 <dd>
  The URI of an icon in the favicon service. Can be <code>null</code>.</dd>
</dl>
<p></p><div class="headingWithIndicator">
        <h3 id="setAndLoadFaviconForPage()">setAndLoadFaviconForPage()</h3>
        <span class="obsolete obsoleteMethod notecard inline">Obsolete since Gecko 22.0 (Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)</span>
        </div><p></p>
<div class="note">
 <p><strong>Note:</strong> This method was removed in <span title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Gecko 22.0</span>. You should use the new async API <code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIAsyncFavicons#setAndFetchFaviconForPage()">mozIAsyncFavicons.setAndFetchFaviconForPage()</a></code> instead.</p>
</div>
<p>This method is same as <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#SetFaviconUrlForPage()">SetFaviconUrlForPage()</a></code> except that this also attempts to set the data by loading the favicon URI. An async request will be created for this URI and if the data is available, it will asynchronously get saved in the database without any further work from the caller.</p>
<p>If the icon data already exists, we won&apos;t normally try to re-load the icon from the net (or more likely the cache). If the icon is in the failed favicon cache we won&apos;t do anything. Use <code>aForceReload</code> to force a reload of the data. This will remove the favicon from the failed cache. If it then fails again, it will be re-added to the failed cache.</p>
<p><code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#SetFaviconUrlForPage()">SetFaviconUrlForPage()</a></code> and <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#setFaviconData()">setFaviconData()</a></code> will take any URL you provide and save it. This function is intended for automatic usage, and will only save favicons for &quot;good&quot; URLs, as defined by what gets added to history. For &quot;bad&quot; URLs, this function will succeed and do nothing. This function will also ignore the error page favicon URI (<code><a class="external" rel="freelink">chrome://global/skin/icons/warning-16.png</a></code>). Icons that fail to load will automatically be added to the failed favicon cache.</p>
<p>This function will not save favicons for non-bookmarked URLs when history is disabled (expiration time is 0 days). The rest of the functions here will always store favicons even when history is disabled.</p>
<pre class="eval">void setAndLoadFaviconForPage(
  in nsIURI aPageURI,
  in nsIURI aFaviconURI,
  in boolean aForceReload,
<code>  in unsigned long aFaviconLoadType, </code>
  in nsIFaviconDataCallback aCallback <span class="optional optionalInline notecard inline">Optional from Gecko 2.0</span>
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aPageURI</code></dt>
 <dd>
  URI of the page whose favicon is being set.</dd>
 <dt>
  <code>aFaviconURI</code></dt>
 <dd>
  URI of the favicon to associate with the page.</dd>
 <dt>
  <code>aForceReload</code></dt>
 <dd>
  Unset is normal behavior, we will only try to reload the favicon if we don&apos;t have it or if it has expired from the cache. If set, it will always try to reload the favicon.</dd>
 <dt>
  <code><strong>aFaviconLoadType</strong></code> </dt>
 <dd>
  One of <code>nsIFaviconService.FAVICON_LOAD_PRIVATE</code> or <code>nsIFaviconService.FAVICON_LOAD_NON_PRIVATE</code> to indicate that any network requests performed should act like ones from a private browsing context (ie. no history entries, only store in the temporary disk cache, etc.). This should be determined via <code>PrivateBrowsingUtils.isWindowPrivate(<em>someRelatedWindow</em>)</code> if the favicon may expose the user&apos;s private browsing data by performing a network request, otherwise <code>FAVICON_LOAD_NON_PRIVATE</code> may be used.</dd>
 <dt>
  <code>aCallback</code> <span class="optional optionalInline notecard inline">Optional from Gecko 2.0</span> </dt>
 <dd>
  An <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconDataCallback" title>nsIFaviconDataCallback</a></code>.</dd>
</dl>
<h6 id="Example" name="Example">Example</h6>
<pre>var ioservice = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]
                          .getService(Components.interfaces.nsIIOService);
var pageURI = ioservice.newURI(&quot;http://www.mozilla.org/&quot;, null, null);
var faviconURI = ioservice.newURI(&quot;http://www.mozilla.org/favicon.ico&quot;, null, null);

faviconService.setAndLoadFaviconForPage(pageURI, faviconURI, false);
</pre>
<p></p><div class="headingWithIndicator">
        <h3 id="setFaviconData()">setFaviconData()</h3>
        <span class="obsolete obsoleteMethod notecard inline">Obsolete since Gecko 22.0 (Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)</span>
        </div><p></p>
<div class="note">
 <p><strong>Note:</strong> This method was removed in <span title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Gecko 22.0</span>. You should use the new async API <code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIAsyncFavicons#replaceFaviconData()">mozIAsyncFavicons.replaceFaviconData()</a></code> instead.</p>
</div>
<p>This method stores the data of a given favicon. You must specify the <code>MIME</code> type unless you&apos;re clearing the data.</p>
<p>You can set the data even if you haven&apos;t called <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#setFaviconUrlForPage()">setFaviconUrlForPage()</a></code> yet. It will be stored but will not be associated with any page. However, any favicons not associated with a visited web page, bookmark, or <code>&quot;place:&quot;</code> URI will be expired when history cleanup is done. This might be done at any time on a timer, so you should not let the message loop run between calls or your icon may get deleted.</p>
<p>It is best to set the favicon data, and then associate it with a page. This will make the notifications more efficient since the icon will already have data when the set favicon observer messages goes out.</p>
<p>The expiration time is stored. This will be used if you call <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#setAndLoadFaviconForPage()">setAndLoadFaviconForPage()</a></code> to see whether the data needs reloading.</p>
<p>Do not use this function for <code>&quot;chrome:&quot;</code> icon URLs. You should reference the chrome image yourself. The <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#getFaviconLinkForIcon()">getFaviconLinkForIcon()</a></code> and <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#getFaviconForPage()">getFaviconForPage()</a></code> will ignore any associated data if the favicon URI is <code>&quot;chrome:&quot;</code> and just return the same chrome URI.</p>
<p>This function does NOT send out notifications that the data has changed. Potentially, many pages could be referencing the favicon and they could be visible in a history view or toolbar. But sending out those notifications is very intensive. Those pages will keep the old icon until they have been refreshed by other means.</p>
<pre class="eval">void setFaviconData(
  in nsIURI aFaviconURI,
  [const,array,size_is(aDataLen)] in octet aData,
  in unsigned long aDataLen, <span class="optional optionalInline notecard inline">Optional from Gecko 2.0</span>
  in AUTF8String aMimeType,
  in PRTime aExpiration
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aFaviconURI</code></dt>
 <dd>
  URI of the favicon whose data is being set.</dd>
 <dt>
  <code>aData</code></dt>
 <dd>
  Binary contents of the favicon to save.</dd>
 <dt>
  <code>aDataLen</code> <span class="optional optionalInline notecard inline">Optional from Gecko 2.0</span></dt>
 <dd>
  Length of binary data.</dd>
 <dt>
  <code>aMimeType</code></dt>
 <dd>
  <code>MIME</code> type of the data to store. This is important so that we know what to report when the favicon is used. You should always set this param unless you are clearing an icon.</dd>
 <dt>
  <code>aExpiration</code></dt>
 <dd>
  Time in microseconds since the epoch when this favicon expires. Until this time, we won&apos;t try to load it again.</dd>
</dl>
<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>
<dl>
 <dt>
  <code>NS_ERROR_FAILURE</code></dt>
 <dd>
  Thrown if the favicon is overbloated and won&apos;t be saved to the db.</dd>
</dl>
<p></p><div class="headingWithIndicator">
        <h3 id="setFaviconDataFromDataURL()">setFaviconDataFromDataURL()</h3>
        <span class="obsolete obsoleteMethod notecard inline">Obsolete since Gecko 22.0 (Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)</span>
        </div><p></p>
<div class="note">
 <p><strong>Note:</strong> This method was removed in <span title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Gecko 22.0</span>. You should use the new async API <code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIAsyncFavicons#replaceFaviconDataFromDataURL()">mozIAsyncFavicons.replaceFaviconDataFromDataURL()</a></code> instead.</p>
</div>
<p>This method stores the data of a given favicon. The data is provided using a <code>data</code> URL string.</p>
<p>This function tries to optimize the favicon size; if it&apos;s bigger than a defined limit, Gecko attempts to convert it to a 16x16 pixel PNG image. If that fails and the image is bigger than a maximum acceptable favicon size, the entire operation fails and the favicon isn&apos;t saved.</p>
<p>It is best to set the favicon data, and then associate it with a page. This will make the notifications more efficient since the icon will already have data when the set favicon observer messages goes out.</p>
<p>The expiration time is stored. This will be used if you call <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#setAndLoadFaviconForPage()">setAndLoadFaviconForPage()</a></code> to see whether the data needs reloading.</p>
<p>Do not use this function for <code>&quot;chrome:&quot;</code> icon URLs. You should reference the chrome image yourself. The <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#getFaviconLinkForIcon()">getFaviconLinkForIcon()</a></code> and <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#getFaviconForPage()">getFaviconForPage()</a></code> will ignore any associated data if the favicon URI is <code>&quot;chrome:&quot;</code> and just return the same chrome URI.</p>
<p>This function does <strong>not</strong> send out notifications that the data has changed. Potentially, many pages could be referencing the favicon and they could be visible in a history view or toolbar. But sending out those notifications is very intensive. Those pages will keep the old icon until they have been refreshed by other means.</p>
<pre class="eval">void setFaviconDataFromDataURL(
  in nsIURI aFaviconURI,
  in AString aDataURL,
  in PRTime aExpiration
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aFaviconURI</code></dt>
 <dd>
  URI of the favicon whose data is being set.</dd>
 <dt>
  <code>aDataURL</code></dt>
 <dd>
  String containing a data URL that represents the contents of the favicon to save.</dd>
 <dt>
  <code>aExpiration</code></dt>
 <dd>
  The time in microseconds since epoch when this favicon expires; until this time, we won&apos;t try to load the favicon again.</dd>
</dl>
<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>
<dl>
 <dt>
  <code>NS_ERROR_FAILURE</code></dt>
 <dd>
  Thrown if the favicon is overbloated and won&apos;t be saved to the db.</dd>
</dl>
<p></p><div class="headingWithIndicator">
        <h3 id="setFaviconUrlForPage()">setFaviconUrlForPage()</h3>
        <span class="obsolete obsoleteMethod notecard inline">Obsolete since Gecko 22.0 (Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)</span>
        </div><p></p>
<div class="note">
 <p><strong>Note:</strong> This method was removed in <span title="(Firefox 22.0 / Thunderbird 22.0 / SeaMonkey 2.19)">Gecko 22.0</span>. You should use the new async API <code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/mozIAsyncFavicons#setAndFetchFaviconForPage()">mozIAsyncFavicons.setAndFetchFaviconForPage()</a></code> instead.</p>
</div>
<p>This method declares that a given page uses a favicon with the given URI.</p>
<p>You needn&apos;t have any specified data at this point. An entry linking the favicon with the page will be create with no data. You can populate it later with <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService#SetFaviconData()">SetFaviconData()</a></code>. However, any favicons not associated with a visited web page, a bookmark, or a <code>&quot;place:&quot;</code> URI will be expired when history cleanup is done * (typically at app shutdown, but also possibly if the user clears their * cache or history).</p>
<p>This will send out history notifications if the new favicon has any data. This means that you should try to set data first if you have it, otherwise the page might not get a notification sent for it since data setting does not send notifications.</p>
<pre class="eval">void setFaviconUrlForPage(
  in nsIURI aPageURI,
  in nsIURI aFaviconURI
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aPageURI</code></dt>
 <dd>
  URI of the page whose favicon is being set.</dd>
 <dt>
  <code>aFaviconURI</code></dt>
 <dd>
  URI of the favicon to associate with the page.</dd>
</dl>
<h2 id="See_also" name="See_also">See also</h2>
<ul>
 <li><a href="/en/Places" title="en/Places">Places</a></li>
 <li><a href="/en/Using_the_Places_favicon_service" title="en/Using_the_Places_favicon_service">Using the Places favicon service</a></li>
 <li><a href="/en/Using_the_Places_annotation_service" title="en/Using_the_Places_annotation_service">Using the Places annotation service</a></li>
</ul>
