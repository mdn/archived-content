<p></p><div style="border: solid #ddd 2px; margin-bottom: 12px;">
<div style="background: #eee; padding: 2px;"><code><a href="https://dxr.mozilla.org/mozilla-central/source/dom/interfaces/push/nsIPushService.idl" rel="custom">dom/interfaces/push/nsIPushService.idl</a></code><span style="text-align: right; float: right;"><a href="/en-US/docs/Interfaces/About_Scriptable_Interfaces" style="color: #00cc00; font-weight: 700;">Scriptable</a></span></div>
<span style="padding: 4px 2px;">

Includes information needed to send a push message to privileged code.
</span>

<div style="background: #eee; padding: 2px;">
Inherits from: <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsISupports" title="">nsISupports</a></code>
<span style="text-align: right; float: right;">Last changed in Gecko 46.0 (Firefox 46.0 / Thunderbird 46.0 / SeaMonkey 2.43)</span></div>
</div><p></p>

<p>Each subscription is associated with a unique URL generated by the Push service. Sending a <code>POST</code> request to this URL routes the message to the instance of Firefox that created the subscription. A subscription also has a public key and secret; these are used to encrypt message payloads.</p>

<p>This interface resembles <a href="/en-US/docs/Web/API/PushSubscription" title="The PushSubscription interface of the Push API provides a subcription's URL endpoint and allows unsubscription from a push service."><code>PushSubscription</code></a> from the <a class="external" href="https://w3c.github.io/push-api/" hreflang="en" lang="en" title="The 'Push API' specification">Push API</a>.</p>

<h2 id="Method_overview" name="Method_overview">Method overview</h2>

<table class="standard-table">
 <tbody>
  <tr>
   <td><code>void <a href="#getKey()">getKey</a>(in DOMString name, [optional] out uint32_t keyLen, [array, size_is(keyLen), retval] out uint8_t key);</code></td>
  </tr>
  <tr>
   <td><code>bool <a href="#quotaApplies()">quotaApplies</a>();</code></td>
  </tr>
  <tr>
   <td><code>bool <a href="#isExpired()">isExpired</a>();</code></td>
  </tr>
 </tbody>
</table>

<h2 id="Attributes" name="Attributes">Attributes</h2>

<table class="standard-table">
 <tbody>
  <tr>
   <td class="header">Attribute</td>
   <td class="header">Type</td>
   <td class="header">Description</td>
  </tr>
  <tr>
   <td><code>endpoint</code></td>
   <td><code>DOMString</code></td>
   <td>The subscription URL.</td>
  </tr>
  <tr>
   <td><code>pushCount</code></td>
   <td><code>long long</code></td>
   <td>The total number of messages sent to this subscription.</td>
  </tr>
  <tr>
   <td><code>lastPush</code></td>
   <td><code>long long</code></td>
   <td>The last time a message was sent to this subscription, in milliseconds since the epoch.</td>
  </tr>
  <tr>
   <td><code>quota</code></td>
   <td><code>long</code></td>
   <td>The number of remaining background messages for this subscription, or <code>-1</code> if exempt.</td>
  </tr>
 </tbody>
</table>

<h2 id="Methods" name="Methods">Methods</h2>

<h3 id="getKey()" name="getKey()">getKey()</h3>

<p>Returns a byte array containing the key material for this subscription. The remote server can use these keys to encrypt and authenticate message payloads. The following key names are supported:</p>

<table class="standard-table">
 <tbody>
  <tr>
   <td><code>p256dh</code></td>
   <td>The ECDH public key, used as the input keying material in the HKDF invocation during encryption.</td>
  </tr>
  <tr>
   <td><code>auth</code></td>
   <td>The shared authentication secret, used as the salt in the HKDF invocation.</td>
  </tr>
 </tbody>
</table>

<pre class="eval">void getKey(
  in DOMString name,
  [optional] out uint32_t keyLen,
  [array, size_is(keyLen), retval] out uint8_t key
);
</pre>

<h4 id="getKey-parameters" name="getKey-parameters">Parameters</h4>

<dl>
 <dt><code>name</code></dt>
 <dd>The encryption key name.</dd>
 <dt><code>keyLen</code></dt>
 <dd>The keying material length.</dd>
 <dt><code>key</code></dt>
 <dd>The byte array containing the keying material.</dd>
</dl>

<div class="note">
<p><code>keyLen</code> and <code>key</code> are out parameters. When called from JavaScript, <code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIPushSubscription#getKey()">nsIPushSubscription.getKey()</a></code> only takes <code>name</code> as a parameter, and returns <code>key</code>. Please see <a href="/en-US/docs/Mozilla/XPIDL#Method_parameters" title="XPIDL is an Interface Description Language used to specify XPCOM interface classes.">Method parameters</a> in <a href="/en-US/docs/Mozilla/XPIDL" title="XPIDL is an Interface Description Language used to specify XPCOM interface classes.">XPIDL</a> for more details on using out parameters in JavaScript.</p>
</div>

<h3 id="quotaApplies()" name="quotaApplies()">quotaApplies()</h3>

<p>Indicates whether this subscription is subject to the background message quota.</p>

<pre class="eval">bool quotaApplies();
</pre>

<div class="note">
<p><code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIPushSubscription#quotaApplies()">nsIPushSubscription.quotaApplies()</a></code> always returns <code>false</code> for system subscriptions.</p>
</div>

<h4 id="quotaApplies-parameters" name="quotaApplies-parameters">Parameters</h4>

<p>None.</p>

<h3 id="isExpired()" name="isExpired()">isExpired()</h3>

<p>Indicates whether this subscription has expired and must be renewed. A subscription expires if its service worker exceeds the quota, or if the <code>desktop-notification</code> permission for its origin is revoked.</p>

<pre class="eval">bool isExpired();
</pre>

<div class="note">
<p><code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIPushSubscription#isExpired()">nsIPushSubscription.isExpired()</a></code> always returns <code>false</code> for system subscriptions.</p>
</div>

<h4 id="isExpired-parameters" name="isExpired-parameters">Parameters</h4>

<p>None.</p>

<h2 id="Example" name="Example">Example</h2>

<pre class="brush: javascript">const { classes: Cc, interfaces: Ci, utils: Cu } = Components;

const scriptSecurityManager = Cc["@mozilla.org/scriptsecuritymanager;1"]
                                .getService(Ci.nsIScriptSecurityManager);
const pushService = Cc["@mozilla.org/push/Service;1"]
                      .getService(Ci.nsIPushService);

function sendSubscriptionToServer(subscription) {
  let request = Cc["@mozilla.org/xmlextras/xmlhttprequest;1"]
                  .createInstance(Ci.nsIXMLHttpRequest);
  request.open("POST", "https://example.com/register-for-push", true);
  request.addEventListener("error", () =&gt; {
    Cu.reportError("Error sending subscription to server");
  });
  request.send(JSON.stringify({
    endpoint: subscription.endpoint,

    // Base64-encode the key and authentication secret.
    key: String.fromCharCode.apply(null, btoa(subscription.getKey("p256dh"))),
    secret: String.fromCharCode.apply(null, btoa(subscription.getKey("auth"))),
  }));
}

pushService.subscribe(
  "chrome://my-module/push",
  scriptSecurityManager.getSystemPrincipal(),
  (code, subscription) =&gt; {
    if (!Components.isSuccessCode(code)) {
      Cu.reportError("Error creating subscription: " + code);
    } else {
      sendSubscriptionToServer(subscription);
    }
  }
);
</pre>

<h2 id="See_also" name="See_also">See also</h2>

<ul>
 <li><code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIPushService" title="">nsIPushService</a></code></li>
 <li><code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIPushMessage" title="">nsIPushMessage</a></code></li>
 <li><a href="/en-US/docs/Web/API/PushSubscription" title="The PushSubscription interface of the Push API provides a subcription's URL endpoint and allows unsubscription from a push service."><code>PushSubscription</code></a></li>
</ul>