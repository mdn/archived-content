<h1 id="nsIMsgHeaderParser">nsIMsgHeaderParser</h1>

<p>Defined in <strong><a class="external" href="http://mxr.mozilla.org/comm-central/source/">comm-central</a>/ <a class="external" href="http://mxr.mozilla.org/comm-central/source/mailnews/">mailnews</a>/ <a class="external" href="http://mxr.mozilla.org/comm-central/source/mailnews/mime/">mime</a>/ <a class="external" href="http://mxr.mozilla.org/comm-central/source/mailnews/mime/public/">public</a>/ <a class="external" href="http://mxr.mozilla.org/comm-central/source/mailnews/mime/public/nsIMsgHeaderParser.idl">nsIMsgHeaderParser.idl</a> </strong></p>

<p></p><div style="border: solid #ddd 2px; margin-bottom: 12px;">
<div style="background: #eee; padding: 2px;"><code><a href="https://dxr.mozilla.org/mozilla-central/source/mailnews/mime/public/nsIMsgHeaderParser.idl" rel="custom">mailnews/mime/public/nsIMsgHeaderParser.idl</a></code><span style="text-align: right; float: right;"><a href="/en-US/docs/Interfaces/About_Scriptable_Interfaces" style="color: #00cc00; font-weight: 700;">Scriptable</a></span></div>
<span style="padding: 4px 2px;">

??? Add brief description of Interface ???
</span>

<div style="background: #eee; padding: 2px;">
Inherits from: <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsISupports" title="">nsISupports</a></code>
<span style="text-align: right; float: right;">Last changed in Gecko 1.9 (Firefox 3)</span></div>
</div><p></p>

<p>To create an instance, use:</p>

<pre class="eval">var msgHeaderParser = Components.classes["@mozilla.org/messenger/headerparser;1"]
                      .createInstance(Components.interfaces.nsIMsgHeaderParser);
</pre>

<h2 id="Method_overview" name="Method_overview">Method overview</h2>

<table class="standard-table">
 <tbody>
  <tr>
   <td><code>string <a href="#extractHeaderAddressMailboxes()">extractHeaderAddressMailboxes</a>(in string line);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#extractHeaderAddressName()">extractHeaderAddressName</a>(in string line, out string name);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#extractHeaderAddressNames()">extractHeaderAddressNames</a>(in string line, out string userNames);</code></td>
  </tr>
  <tr>
   <td><code>AString <a href="#makeFullAddress()">makeFullAddress</a>(in AString aName, in AString aAddress);</code></td>
  </tr>
  <tr>
   <td><code>string <a href="#makeFullAddressString()">makeFullAddressString</a>(in string aName, in string aAddress);</code> </td>
  </tr>
  <tr>
   <td><code>wstring <a href="#makeFullAddressWString()">makeFullAddressWString</a>(in wstring name, in wstring addr);</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 3)">Obsolete since Gecko 1.9</span></td>
  </tr>
  <tr>
   <td><code>void <a href="#parseHeaderAddresses()">parseHeaderAddresses</a>(in string line, out string names, out string addresses, out PRUint32 numAddresses);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#parseHeadersWithArray()">parseHeadersWithArray</a>(in wstring aLine, [array, size_is(count)] out wstring aEmailAddresses, [array, size_is(count)] out wstring aNames, [array, size_is(count)] out wstring aFullNames, [retval] out unsigned long count);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#reformatHeaderAddresses()">reformatHeaderAddresses</a>(in string line, out string reformattedAddress);</code></td>
  </tr>
  <tr>
   <td><code>wstring <a href="#reformatUnquotedAddresses()">reformatUnquotedAddresses</a>(in wstring line);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#removeDuplicateAddresses()">removeDuplicateAddresses</a>(in string addrs, in string other_addrs, in PRBool removeAliasesToMe, out string newAddress);</code></td>
  </tr>
  <tr>
   <td><code>string <a href="#unquotePhraseOrAddr()">unquotePhraseOrAddr</a>(in string line, in boolean preserveIntegrity);</code></td>
  </tr>
  <tr>
   <td><code>wstring <a href="#unquotePhraseOrAddrWString()">unquotePhraseOrAddrWString</a>(in wstring line, in boolean preserveIntegrity);</code></td>
  </tr>
 </tbody>
</table>

<h2 id="Methods" name="Methods">Methods</h2>

<h3 id="extractHeaderAddressMailboxes()" name="extractHeaderAddressMailboxes()">extractHeaderAddressMailboxes()</h3>

<p>Given a string which contains a list of Header addresses, returns a comma-separated list of just the 'mailbox' portions. If any of the addresses doesn't have a mailbox, then the user name is used instead.</p>

<pre class="eval"><span id="the-code"><a class="d external" href="http://mxr.mozilla.org/comm-central/ident?i=AUTF8String">AUTF8String</a> </span>extractHeaderAddressMailboxes(
  in string line
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<p><code>line</code></p>

<dl>
 <dd>The header line to parse.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>A comma-separated list of just the mailbox parts of the addresses.</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<p></p><div><span class="indicatorInHeadline noscript noscriptMethod" title="This method may only be called from C++; don't use it from JavaScript.">Native code only!</span><h3 id="extractHeaderAddressNames">extractHeaderAddressNames</h3></div><p></p>

<p>Given a string which contains a list of Header addresses, returns a comma-separated list of just the 'user name' portions.  If any of the addresses doesn't have a name, then the mailbox is used instead.</p>

<pre class="eval"><span id="the-code"><a class="d external" href="http://mxr.mozilla.org/comm-central/ident?i=AUTF8String">AUTF8String</a> </span>extractHeaderAddressNames(
  in string line
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>line</code></dt>
 <dd>The header line to parse.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>A comma-separated list of just the name parts of the addresses.</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<p></p><div><span class="indicatorInHeadline noscript noscriptMethod" title="This method may only be called from C++; don't use it from JavaScript.">Native code only!</span><h3 id="extractHeaderAddressName">extractHeaderAddressName</h3></div><p></p>

<p>Like extractHeaderAddressNames(), but only returns the first name in the list, if there is more than one.</p>

<pre class="eval"><span id="the-code"><a class="d external" href="http://mxr.mozilla.org/comm-central/ident?i=AUTF8String">AUTF8String</a> </span>extractHeaderAddressName(
  in string line
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>line</code></dt>
 <dd>The header line to parse.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>The first name found in the list</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<h3 id="makeFullAddress()" name="makeFullAddress()">makeFullAddress()</h3>

<p>Given an e-mail address and a person's name, concatenates them together into a single string, doing all the necessary quoting.</p>

<pre class="eval">AString makeFullAddress(
  in AString aName,
  in AString aAddress
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aName</code></dt>
 <dd>The name of the sender. This should be in UTF-8.</dd>
 <dt><code>aAddress</code></dt>
 <dd>The address of the sender. This should be in UTF-8.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>A string of the form name &lt;address&gt;.</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<p></p><div><span class="indicatorInHeadline noscript noscriptMethod" title="This method may only be called from C++; don't use it from JavaScript.">Native code only!</span><h3 id="makeFullAddressString">makeFullAddressString</h3></div><p></p>

<p></p>

<p>Given an e-mail address and a person's name, cons them together into a single string, doing all the necessary quoting (const char* version).</p>

<pre class="eval">string makeFullAddressString(
  in string aName,
  in string aAddress
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aName</code></dt>
 <dd>The name of the sender. This should be in UTF-8.</dd>
 <dt><code>aAddress</code></dt>
 <dd>The address of the sender. This should be in UTF-8.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>A string of the form name &lt;address&gt;.</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<p></p><div class="headingWithIndicator">
        <h3 id="makeFullAddressWString()">makeFullAddressWString()</h3>
        <span class="indicatorInHeadline obsolete obsoleteMethod">Obsolete since Gecko 1.9 (Firefox 3)</span>
        </div><p></p>

<pre class="eval">wstring makeFullAddressWString(
  in wstring name,
  in wstring addr
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>name</code></dt>
 <dd>The name of the sender. This should be in UTF-8.</dd>
 <dt><code>addr</code></dt>
 <dd>The address of the sender. This should be in UTF-8.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>A string of the form name &lt;address&gt;.</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<p></p><div><span class="indicatorInHeadline noscript noscriptMethod" title="This method may only be called from C++; don't use it from JavaScript.">Native code only!</span><h3 id="parseHeaderAddresses">parseHeaderAddresses</h3></div><p></p>

<p>Given a string which contains a list of Header addresses, parses it into their component names and mailboxes.<br>
 <br>
 The returned value is the number of addresses, or a negative error code; the names and addresses are returned into the provided pointers as consecutive null-terminated strings.  It is up to the caller to free them. Note that some of the strings may be zero-length.<br>
 <br>
 The caller may pass nsnull for charset and it will be interpreted as "us-ascii".<br>
 <br>
 Either of the provided pointers may be NULL if the caller is not interested in those components.</p>

<pre class="eval">void parseHeaderAddresses(
  in string line,
  out string names,
  out string addresses,
  out PRUint32 numAddresses
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>line</code></dt>
 <dd>The header line to parse.</dd>
 <dt><code>names</code></dt>
 <dd>A string of the names in the header line. The names are separated by null-terminators. This param may be null if the caller does not want this part of the result.</dd>
 <dt><code>addresses</code></dt>
 <dd>A string of the addresses in the header line. The addresses are separated by null-terminators. This param may be null if the caller does not want this part of the result.</dd>
 <dt><code>numAddresses</code></dt>
 <dd>The number of addresses in the header. If this is negative, there has been an error parsing the header.</dd>
</dl>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<h3 id="parseHeadersWithArray()" name="parseHeadersWithArray()">parseHeadersWithArray()</h3>

<pre class="eval">void parseHeadersWithArray(
  in wstring aLine,
  [array, size_is(count)] out wstring aEmailAddresses,
  [array, size_is(count)] out wstring aNames,
  [array, size_is(count)] out wstring aFullNames,
  [retval] out unsigned long count
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aLine</code></dt>
 <dd>The header line to parse.</dd>
 <dt><code>aEmailAddresses</code></dt>
 <dd>Missing Description</dd>
 <dt><code>aNames</code></dt>
 <dd>Missing Description</dd>
 <dt><code>aFullNames</code></dt>
 <dd>Missing Description</dd>
 <dt><code>count</code></dt>
 <dd>Missing Description</dd>
</dl>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<p></p><div><span class="indicatorInHeadline noscript noscriptMethod" title="This method may only be called from C++; don't use it from JavaScript.">Native code only!</span><h3 id="reformatHeaderAddresses">reformatHeaderAddresses</h3></div><p></p>

<p>Given a string which contains a list of Header addresses, returns a new string with the same data, but inserts missing commas, parses and reformats it, and wraps long lines with newline-tab.</p>

<pre class="eval">string reformatHeaderAddresses(
  in string line
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>line</code></dt>
 <dd>The header line to parse.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>The reformatted header line.</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<h3 id="reformatUnquotedAddresses()" name="reformatUnquotedAddresses()">reformatUnquotedAddresses()</h3>

<p>Given a string, will make it safe to use by adding missing quote and escaping needed quote</p>

<pre class="eval">wstring reformatUnquotedAddresses(
  in wstring line
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>line</code></dt>
 <dd>The header line to parse.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>Safe Addresses (?)</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<p></p><div><span class="indicatorInHeadline noscript noscriptMethod" title="This method may only be called from C++; don't use it from JavaScript.">Native code only!</span><h3 id="removeDuplicateAddresses">removeDuplicateAddresses</h3></div><p></p>

<p>Returns a copy of ADDRS which may have had some addresses removed. Addresses are removed if they are already in either ADDRS or OTHER_ADDRS. (If OTHER_ADDRS contain addresses which are not in ADDRS, they are not added.  That argument is for passing in addresses that were already mentioned in other header fields.)<br>
 <br>
 Addresses are considered to be the same if they contain the same mailbox part (case-insensitive.)  Real names and other comments are not compared.<br>
 <br>
 removeAliasesToMe allows the address parser to use the preference which contains regular expressions which also mean 'me' for the purpose of stripping the user's email address(es) out of addrs</p>

<pre class="eval">string removeDuplicateAddresses(
  in string addrs,
  in string other_addrs,
  in PRBool removeAliasesToMe
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>addrs</code></dt>
 <dd>The addresses to remove duplicates from.</dd>
 <dt><code>other_addrs</code></dt>
 <dd>Other addresses that the duplicate removal process also checks for duplicates against. Addresses in this list will not be added to the result.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<dl>
 <dd>A string based on the original without the duplicate addresses.</dd>
</dl>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<p></p><div><span class="indicatorInHeadline noscript noscriptMethod" title="This method may only be called from C++; don't use it from JavaScript.">Native code only!</span><h3 id="unquotePhraseOrAddr">unquotePhraseOrAddr</h3></div><p></p>

<p>This function removes the quoting if you want to show the names to users. e.g. summary file, address book. If preserveIntegrity is set to true, quote will not be removed in case the name part of the email contains a comma.</p>

<pre class="eval">string unquotePhraseOrAddr(
  in string line,
  in boolean preserveIntegrity
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>line</code></dt>
 <dd>The header line to parse.</dd>
 <dt><code>preserveIntegrity</code></dt>
 <dd>Set to true, quote will not be removed</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>User friendly names</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<h3 id="unquotePhraseOrAddrWString()" name="unquotePhraseOrAddrWString()">unquotePhraseOrAddrWString()</h3>

<p>This function removes the quoting if you want to show the names to users. e.g. summary file, address book. If preserveIntegrity is set to true, quote will not be removed in case the name part of the email contains a comma.</p>

<pre class="eval">wstring unquotePhraseOrAddrWString(
  in wstring line,
  in boolean preserveIntegrity
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>line</code></dt>
 <dd>The header line to parse.</dd>
 <dt><code>preserveIntegrity</code></dt>
 <dd>Missing Description</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>Missing Description</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>Missing Exception</code></dt>
 <dd>Missing Description</dd>
</dl>

<h2 id="Remarks" name="Remarks">Remarks</h2>

<p>I think some of the charset parameters might be obsolete... So this page is still W.I.P.</p>

<h2 id="See_also" name="See_also">See also</h2>