---
title: nsINavHistoryObserver
slug: Mozilla/Tech/XPCOM/Reference/Interface/nsINavHistoryObserver
tags:
  - Developing Mozilla
  - Extensions
  - Interfaces
  - 'Interfaces:Scriptable'
  - Places
  - XPCOM
  - XPCOM API Reference
  - XPCOM Interface Reference
---
<p></p><div style="border: solid #ddd 2px; margin-bottom: 12px;">
<div style="background: #eee; padding: 2px;"><code><a href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/places/nsINavHistoryService.idl" rel="custom">toolkit/components/places/nsINavHistoryService.idl</a></code><span style="text-align: right; float: right;"><a href="/en-US/docs/Interfaces/About_Scriptable_Interfaces" style="color: #00cc00; font-weight: 700;">Scriptable</a></span></div>
<span style="padding: 4px 2px;">

This interface is similar to the nsIRDFObserver class, but is used to observe interactions on the global history.
</span>

  <div style="height: 42px; position: relative; padding: 2px; width: auto;">

  <div style="top: 22px; font-size: 11px; position: absolute;">1.0</div>

  <div style="top: 22px; font-size: 11px; position: absolute; left: 0px; text-align: right; float: right; width: 100%;">66</div>

  <div style="height: 8px; top: 16px; background: #dd0000; left: 0px; position: absolute; width: 5.714285714285714%;"></div>

<div style="height: 8px; top: 16px; left: 5.714285714285714%; background: #00dd00; position: absolute; width: 94.28571428571429%;" title="Introduced in Gecko 1.8 (Firefox 1.5 / Thunderbird 1.5 / SeaMonkey 1.0)"></div>

<div style="top: 0px; font-size: 11px; position: absolute; left: 5.714285714285714%;">Introduced</div>
<div style="top: 22px; font-size: 11px; position: absolute; left: 5.714285714285714%;">Gecko 1.8</div>

    <div style="height: 8px; top: 16px; left: 35.214285714285715%; background: #eeee00; position: absolute; width: 1%; border-radius: 4px; -webkit-border-radius: 4px;" title="Last changed in Gecko 21.0 (Firefox 21.0 / Thunderbird 21.0 / SeaMonkey 2.18)"></div>

</div>

<div style="background: #eee; padding: 2px;">
Inherits from: <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsISupports" title="">nsISupports</a></code>
<span style="text-align: right; float: right;">Last changed in Gecko 21.0 (Firefox 21.0 / Thunderbird 21.0 / SeaMonkey 2.18)</span></div>
</div><p></p>
<div class="warning">
 <strong>Warning:</strong> If you are in the middle of a batch transaction, there may be a database transaction active. You can still access the database in this situation but be careful (<em>of what?</em>).</div>
<h2 id="Method_overview" name="Method_overview">Method overview</h2>
<table class="standard-table">
 <tbody>
  <tr>
   <td><code>void <a href="#onBeforeDeleteURI()">onBeforeDeleteURI</a>(in nsIURI aURI, in ACString aGUID);</code>  <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 21.0 / Thunderbird 21.0 / SeaMonkey 2.18)">Obsolete since Gecko 21.0</span></td>
  </tr>
  <tr>
   <td><code>void <a href="#onBeginUpdateBatch()">onBeginUpdateBatch</a>();</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#onClearHistory()">onClearHistory</a>();</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#onDeleteURI()">onDeleteURI</a>(in nsIURI aURI, in ACString aGUID);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#onDeleteVisits()">onDeleteVisits</a>(in nsIURI aURI, in PRTime aVisitTime, in ACString aGUID);</code> </td>
  </tr>
  <tr>
   <td><code>void <a href="#onEndUpdateBatch()">onEndUpdateBatch</a>();</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#onPageChanged()">onPageChanged</a>(in nsIURI aURI, in unsigned long aWhat, in AString aValue);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#onPageExpired()">onPageExpired</a>(in nsIURI aURI, in PRTime aVisitTime, in boolean aWholeEntry);</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 4 / Thunderbird 3.3 / SeaMonkey 2.1)">Obsolete since Gecko 2.0</span></td>
  </tr>
  <tr>
   <td><code>void <a href="#onTitleChanged()">onTitleChanged</a>(in nsIURI aURI, in AString aPageTitle);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#onVisit()">onVisit</a>(in nsIURI aURI, in long long aVisitID, in PRTime aTime, in long long aSessionID, in long long aReferringID, in unsigned long aTransitionType, in ACString aGUID, out unsigned long aAdded);</code> </td>
  </tr>
 </tbody>
</table>
<h2 id="Constants" name="Constants">Constants</h2>
<table class="standard-table">
 <tbody>
  <tr>
   <td class="header">Constant</td>
   <td class="header">Value</td>
   <td class="header">Description</td>
  </tr>
  <tr>
   <td><code>ATTRIBUTE_FAVICON</code></td>
   <td><code>3</code></td>
   <td>The page's favicon changed.</td>
  </tr>
 </tbody>
</table>
<h2 id="Methods" name="Methods">Methods</h2>
<p></p><div class="headingWithIndicator">
        <h3 id="onBeforeDeleteURI()">onBeforeDeleteURI()</h3>
        <span class="indicatorInHeadline obsolete obsoleteMethod">Obsolete since Gecko 21.0 (Firefox 21.0 / Thunderbird 21.0 / SeaMonkey 2.18)</span>
        </div><p></p>
<div class="note">
 <p><strong>Note:</strong> This method was removed in <span title="(Firefox 21.0 / Thunderbird 21.0 / SeaMonkey 2.18)">Gecko 21.0</span> as part of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=826409" title="https://bugzilla.mozilla.org/show_bug.cgi?id=826409">Bug 826409</a>.</p>
</div>
<p>The specified page and all its visits are about to be deleted.</p>
<div class="note">
 <strong>Note:</strong> The page does not necessarily have to have ever existed for this function to be called.</div>
<p>Delete notifications aren't quite 100% accurate. Batch delete operations take place in two steps; the notifications come first, followed by a bulk delete. If an error occurs in between these two steps (for example, an out of memory error), then you may get a notification even though the page doesn't wind up getting deleted.</p>
<div class="note">
 <strong>Note:</strong> See <a href="#Using_onBeforeDeleteURI()_in_Gecko_1.9.1">Using onBeforeDeleteURI() in Gecko 1.9.1</a> for how to implement this in <span title="(Firefox 3.5 / Thunderbird 3.0 / SeaMonkey 2.0)">Gecko 1.9.1</span></div>
<pre class="eval">void onBeforeDeleteURI(
  in nsIURI aURI,
  in ACString aGUID
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aURI</code></dt>
 <dd>
  The URI of the page about to be deleted.</dd>
 <dt>
  <code>aGUID</code> </dt>
 <dd>
  The unique ID associated with the page.</dd>
</dl>
<h3 id="onBeginUpdateBatch()" name="onBeginUpdateBatch()">onBeginUpdateBatch()</h3>
<p>Notifies you that a batch of things are about to change. You should avoid doing any heavy-duty processing until <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsINavHistoryObserver#onEndUpdateBatch()">onEndUpdateBatch()</a></code> is called.</p>
<pre class="eval">void onBeginUpdateBatch();
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<p>None.</p>
<h3 id="onClearHistory()" name="onClearHistory()">onClearHistory()</h3>
<p>Called just prior to all of history being cleared.</p>
<pre class="eval">void onClearHistory();
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<p>None.</p>
<h3 id="onDeleteURI()" name="onDeleteURI()">onDeleteURI()</h3>
<p>The specified page and all its visits has been deleted.</p>
<p>Delete notifications are not quite 100% accurate. Batch delete operations take place in two steps; the notifications come first, followed by a bulk delete. If an error occurs in between these two steps (for example, an out of memory error), then you may get a notification even though the page doesn't wind up getting deleted.</p>
<div class="note">
 <strong>Note:</strong> The page does not necessarily have to have ever existed for this function to be called.</div>
<h6 id="onDeleteURI() Notes" name="onDeleteURI() Notes">Notes</h6>
<p>The <code>removePagesByHost()</code> and <code>removePagesByTimeFrame()</code> functions call <code>beginUpdateBatch()</code> and <code>endUpdateBatch()</code> rather than <code>onClearHistory()</code> or <code>onDeleteURI()</code>.</p>
<pre class="eval">void onDeleteURI(
  in nsIURI aURI,
  in ACString aGUID
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aURI</code></dt>
 <dd>
  The URI of the page that was deleted.</dd>
 <dt>
  <code>aGUID</code> </dt>
 <dd>
  The unique ID associated with the page.</dd>
</dl>
<p></p><h3 id="onDeleteVisits()">onDeleteVisits()</h3><p></p>
<p>Called when some visits of an history entry are expired.</p>
<div class="note">
 <strong>Note:</strong> When all visits for a page are expired and also the full page entry is expired, you will only get an onDeleteURI notification. If a page entry is removed, then you can be sure that we don't have anymore visits for it.</div>
<pre class="eval">void onDeleteVisits(
  in nsIURI aURI,
  in PRTime aVisitTime,
  in ACString aGUID
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aURI</code></dt>
 <dd>
  The URI of the page whose visits have been expired.</dd>
 <dt>
  <code>aVisitTime</code></dt>
 <dd>
  The largest visit time in microseconds that has been expired. We guarantee that we do not have any visit older than this date.</dd>
 <dt>
  <code>aGUID</code> </dt>
 <dd>
  The unique ID associated with the page.</dd>
</dl>
<h3 id="onEndUpdateBatch()" name="onEndUpdateBatch()">onEndUpdateBatch()</h3>
<p>Called once a batch of updates is completed. Once this has been called, you can perform processing, user interface updates, and so forth. This is called sometime after <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsINavHistoryObserver#onBeginUpdateBatch()">onBeginUpdateBatch()</a></code>.</p>
<pre class="eval">void onEndUpdateBatch();
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<p>None.</p>
<h3 id="onPageChanged()" name="onPageChanged()">onPageChanged()</h3>
<p>Some attribute on the specified page has changed.</p>
<p>Note that for <code>TYPED</code> and <code>HIDDEN</code> pages, the page might not actually have been added yet. <em>This needs to be clarified; what are TYPED and HIDDEN?</em></p>
<pre class="eval">void onPageChanged(
  in nsIURI aURI,
  in unsigned long aWhat,
  in AString aValue
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aURI</code></dt>
 <dd>
  The URI of the page on which an attribute changed.</dd>
 <dt>
  <code>aWhat</code></dt>
 <dd>
  The attribute whose value changed.</dd>
 <dt>
  <code>aValue</code></dt>
 <dd>
  The attribute's new value.</dd>
</dl>
<p></p><div class="headingWithIndicator">
        <h3 id="onPageExpired()">onPageExpired()</h3>
        <span class="indicatorInHeadline obsolete obsoleteMethod">Obsolete since Gecko 2.0 (Firefox 4 / Thunderbird 3.3 / SeaMonkey 2.1)</span>
        </div><p></p>
<div class="note">
 <strong>Note:</strong> This method was removed in Gecko 2.0. Use <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsINavHistoryObserver#onDeleteVisits()">onDeleteVisits()</a></code> instead.</div>
<p>Called when a history entry expires. This notification is sent to indicate that a specific visit has expired, and includes the time of that visit. When the last visit for a history entry expires, the history entry itself is deleted and the <code>aWholeEntry</code> parameter is <code>true</code>.</p>
<p>If your code only cares about whole entries being deleted instead of individual visits, you can simply act only when <code>aWholeEntry</code> is <code>true</code>.</p>
<p>It's possible for a history entry to be deleted even though it has no visits if something is out of sync after a bookmark with no visits is deleted; this results in the entire history entry being freed). In such cases, <code>aVisitTime</code> is 0.</p>
<pre class="eval">void onPageExpired(
  in nsIURI aURI,
  in PRTime aVisitTime,
  in boolean aWholeEntry
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aURI</code></dt>
 <dd>
  The URI of the page that expired.</dd>
 <dt>
  <code>aVisitTime</code></dt>
 <dd>
  The visit time that expired; this may (or may not) be 0 if a bookmark with no visits is deleted.</dd>
 <dt>
  <code>aWholeEntry</code></dt>
 <dd>
  <code>true</code> if this expiration will result in the entire history entry being deleted from the history store; if <code>false</code>, only the specified visit is being deleted.</dd>
</dl>
<h3 id="onTitleChanged()" name="onTitleChanged()">onTitleChanged()</h3>
<p>Called whenever either the real title or the custom title of the page changes. Both titles are always included in this notification, even though only one is changed each time it is called, since often consumers will want to display the user title if available, falling back to the title specified by the page's <code>&lt;title&gt;</code> element if there is no user title.</p>
<p>It's important to note that there is a difference between an empty title and a <code>null</code> title. An empty string means the title was specifically set to be nothing. <code>null</code> means the title was not set at all. From C++ code, use the <code>IsVoid()</code> and <code>SetIsvoid()</code> methods to see whether an empty string is "<code>null</code>" or not; in either case it will always be an empty string.</p>
<pre class="eval">void onTitleChanged(
  in nsIURI aURI,
  in AString aPageTitle
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aURI</code></dt>
 <dd>
  The URI of the page whose title changed.</dd>
 <dt>
  <code>aPageTitle</code></dt>
 <dd>
  The new title of the page.</dd>
</dl>
<p></p><h3 id="onVisit()">onVisit()</h3><p></p>
<p>Called when a resource is visited. This is called the first time a resource (page, image, and so on.) is seen as well as every subsequent time.</p>
<p>Normally, transition types of TRANSITION_EMBED (corresponding to images in a page, for example) are not displayed in history results (unless includeHidden is set). Many observers can ignore _EMBED notifications (which will comprise the majority of visit notifications) to save work.</p>
<pre class="eval">void onVisit(
  in nsIURI aURI,
  in long long aVisitID,
  in PRTime aTime,
  in long long aSessionID,
  in long long aReferringID,
  in unsigned long aTransitionType,
  in ACString aGUID,
  out unsigned long aAdded
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl>
 <dt>
  <code>aURI</code></dt>
 <dd>
  The URI of the page being visited.</dd>
 <dt>
  <code>aVisitID</code></dt>
 <dd>
  ID of the visit that was just created.</dd>
 <dt>
  <code>aTime</code></dt>
 <dd>
  Time of the visit.</dd>
 <dt>
  <code>aSessionID</code></dt>
 <dd>
  The ID of one connected sequence of visits.</dd>
 <dt>
  <code>aReferringID</code></dt>
 <dd>
  The ID of the visit the user came from. 0 if empty.</dd>
 <dt>
  <code>aTransitionType</code></dt>
 <dd>
  The type of the item that is about to be removed; this is one of the <code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsINavBookmarksService#Constants">nsINavBookmarksService.Constants</a></code> defined in the <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsINavBookmarksService" title="">nsINavBookmarksService</a></code> interface.</dd>
 <dt>
  <code>aGUID</code> </dt>
 <dd>
  The unique ID associated with the page.</dd>
 <dt>
  <code>aAdded</code></dt>
 <dd>
  Incremented by query nodes when the visited uri belongs to them. If no such query exists, the history result creates a new query node dynamically. It is used in places views only and can be ignored.</dd>
</dl>
<h3 id="Using_onBeforeDeleteURI()_in_Gecko_1.9.1" name="Using_onBeforeDeleteURI()_in_Gecko_1.9.1">Using onBeforeDeleteURI() in Gecko 1.9.1</h3>
<p>If you wish to support <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsINavHistoryObserver#onBeforeDeleteURI()">onBeforeDeleteURI()</a></code> in applications based on <span title="(Firefox 3.5 / Thunderbird 3.0 / SeaMonkey 2.0)">Gecko 1.9.1</span>, you must implement your observer's <code>QueryInterface()</code> method to match on both <code>nsINavHistoryObserver</code> and <code>nsINavHistoryObserver_MOZILLA_1_9_1_ADDITIONS</code>, as shown below.</p>
<pre class="brush: js">QueryInterface: function(iid) {
  if (iid.equals(Ci.nsINavHistoryObserver) ||
      iid.equals(Ci.nsINavHistoryObserver_MOZILLA_1_9_1_ADDITIONS) ||
      iid.equals(Ci.nsISupports)) {
    return this;
  }
  throw Cr.NS_ERROR_NO_INTERFACE;
}
</pre>
<h2 id="See_also" name="See_also">See also</h2>
<ul>
 <li><code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsINavHistoryResult" title="">nsINavHistoryResult</a></code></li>
</ul>
