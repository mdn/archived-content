<p></p><div style="border: solid #ddd 2px; margin-bottom: 12px;">
<div style="background: #eee; padding: 2px;"><code><a href="https://dxr.mozilla.org/mozilla-central/source/netwerk/base/public/nsICryptoHash.idl" rel="custom">netwerk/base/public/nsICryptoHash.idl</a></code><span style="text-align: right; float: right;"><a href="/en-US/docs/Interfaces/About_Scriptable_Interfaces" style="color: #00cc00; font-weight: 700;">Scriptable</a></span></div>
<span style="padding: 4px 2px;">

This interface can be used to compute a cryptographic hash function of some data. You can, for example, calculate the <code>SHA256</code> hash of a file to determine if it contains the data you think it does. The hash algorithms supported are MD2, MD5, SHA-1, SHA-256, SHA-384, and SHA-512.
</span>

  <div style="height: 42px; position: relative; padding: 2px; width: auto;">

  <div style="top: 22px; font-size: 11px; position: absolute;">1.0</div>

  <div style="top: 22px; font-size: 11px; position: absolute; left: 0px; text-align: right; float: right; width: 100%;">66</div>

  <div style="height: 8px; top: 16px; background: #dd0000; left: 0px; position: absolute; width: 5.714285714285714%;"></div>

<div style="height: 8px; top: 16px; left: 5.714285714285714%; background: #00dd00; position: absolute; width: 94.28571428571429%;" title="Introduced in Gecko 1.8 (Firefox 1.5 / Thunderbird 1.5 / SeaMonkey 1.0)"></div>

<div style="top: 0px; font-size: 11px; position: absolute; left: 5.714285714285714%;">Introduced</div>
<div style="top: 22px; font-size: 11px; position: absolute; left: 5.714285714285714%;">Gecko 1.8</div>

</div>

<div style="background: #eee; padding: 2px;">
Inherits from: <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsISupports" title="">nsISupports</a></code>
<span style="text-align: right; float: right;">Last changed in Gecko 1.8 (Firefox 1.5 / Thunderbird 1.5 / SeaMonkey 1.0)</span></div>
</div><p></p>

<h2 id="Method_overview" name="Method_overview">Method overview</h2>

<table class="standard-table">
 <tbody>
  <tr>
   <td><code>ACString <a href="#finish()">finish</a>(in PRBool aASCII);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#init()">init</a>(in unsigned long aAlgorithm);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#initWithString()">initWithString</a>(in ACString aAlgorithm);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#update()">update</a>([const, array, size_is(aLen)] in octet aData, in unsigned long aLen);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#updateFromStream()">updateFromStream</a>(in nsIInputStream aStream, in unsigned long aLen);</code></td>
  </tr>
 </tbody>
</table>

<h2 id="Constants" name="Constants">Constants</h2>

<h4 id="Hash_Algorithms" name="Hash_Algorithms">Hash algorithms</h4>

<p>These constants are used by the <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsICryptoHash#init()">init()</a></code> method to indicate which hashing function to use. The values map directly onto the values defined in mozilla/security/nss/lib/cryptohi/hasht.h.</p>

<table class="standard-table">
 <tbody>
  <tr>
   <td class="header">Constant</td>
   <td class="header">Value</td>
   <td class="header">Description</td>
  </tr>
  <tr>
   <td><code>MD2</code></td>
   <td><code>1</code></td>
   <td>Message Digest Algorithm 2</td>
  </tr>
  <tr>
   <td><code>MD5</code></td>
   <td><code>2</code></td>
   <td>Message-Digest algorithm 5</td>
  </tr>
  <tr>
   <td><code>SHA1</code></td>
   <td><code>3</code></td>
   <td>Secure Hash Algorithm 1</td>
  </tr>
  <tr>
   <td><code>SHA256</code></td>
   <td><code>4</code></td>
   <td>Secure Hash Algorithm 256</td>
  </tr>
  <tr>
   <td><code>SHA384</code></td>
   <td><code>5</code></td>
   <td>Secure Hash Algorithm 384</td>
  </tr>
  <tr>
   <td><code>SHA512</code></td>
   <td><code>6</code></td>
   <td>Secure Hash Algorithm 512</td>
  </tr>
 </tbody>
</table>

<h2 id="Methods" name="Methods">Methods</h2>

<h3 id="finish()" name="finish()">finish()</h3>

<p>Completes the hash object and produces the actual hash data.</p>

<p></p><div class="blockIndicator note"><strong>Note:</strong> This method may be called any time after " .. manch("init") .. " is called. This call resets the object.</div><p></p>

<pre class="eval">ACString finish(
  in PRBool aASCII
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aASCII</code></dt>
 <dd>If <code>true</code> then the returned value is a base-64 encoded string. If <code>false</code>, then the returned value is binary data.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>This method returns a hash of the data that was read by this object. This can be either binary data or a base-64 encoded string.</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>NS_ERROR_NOT_INITIALIZED</code></dt>
 <dd>Indicates that <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsICryptoHash#init()">init()</a></code> or <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsICryptoHash#initWithString()">initWithString()</a></code> has not been called.</dd>
</dl>

<h3 id="init()" name="init()">init()</h3>

<p>Initialize the hashing object. This method may be called multiple times with different algorithm types.</p>

<p></p><div class="blockIndicator note"><strong>Note:</strong> This method or " .. manch("initWithString") .. " must be called before any other method on this interface is called.</div><p></p>

<pre class="eval">void init(
  in unsigned long aAlgorithm
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aAlgorithm</code></dt>
 <dd>The hash algorithm to use. Must be one of the <a href="#Hash_algorithms">Hash Algorithms</a>.</dd>
</dl>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>NS_ERROR_INVALID_ARG</code></dt>
 <dd>Indicates that an unsupported algorithm type was passed</dd>
</dl>

<h3 id="initWithString()" name="initWithString()">initWithString()</h3>

<p>Initialize the hashing object. This method may be called multiple times with different algorithm types.</p>

<p></p><div class="blockIndicator note"><strong>Note:</strong> This method or " .. manch("init") .. " must be called before any other method on this interface is called.</div><p></p>

<pre class="eval">void initWithString(
  in ACString aAlgorithm
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aAlgorithm</code></dt>
 <dd>The hash algorithm type to be used as a string, such as <code>"SHA256"</code>.</dd>
</dl>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>NS_ERROR_INVALID_ARG</code></dt>
 <dd>Indicates that an unsupported algorithm type was passed</dd>
</dl>

<h3 id="update()" name="update()">update()</h3>

<p>Adds an array of data to be hashed to the object. See <a href="#Computing_the_Hash_of_a_String">Computing the Hash of a String</a> for an example of using this method.</p>

<pre class="eval">void update(
  [const, array, size_is(aLen)] in octet aData,
  in unsigned long aLen
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aData</code></dt>
 <dd>A buffer to calculate the hash over.</dd>
 <dt><code>aLen</code></dt>
 <dd>The length of the buffer <code>aData</code>.</dd>
</dl>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>NS_ERROR_NOT_INITIALIZED</code></dt>
 <dd>Indicates that <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsICryptoHash#init()">init()</a></code> or <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsICryptoHash#initWithString()">initWithString()</a></code> has not been called.</dd>
</dl>

<h3 id="updateFromStream()" name="updateFromStream()">updateFromStream()</h3>

<p>Calculates and updates a new hash based on a given data stream (<code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIInputStream" title="">nsIInputStream</a></code>). See <a href="#Computing_the_Hash_of_a_File">Computing the Hash of a File</a> for an example of using this method.</p>

<pre class="eval">void updateFromStream(
  in nsIInputStream aStream,
  in unsigned long aLen
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aStream</code></dt>
 <dd>An input stream to read from.</dd>
 <dt><code>aLen</code></dt>
 <dd>How much to read from the given <code>aStream</code>. Passing <code>PR_UINT32_MAX</code> indicates that all data available will be used to update the hash.</dd>
</dl>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>NS_ERROR_NOT_AVAILABLE</code></dt>
 <dd>Indicates that the requested amount of data to be calculated into the hash is not available.</dd>
 <dt><code>NS_ERROR_NOT_INITIALIZED</code></dt>
 <dd>Indicates that <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsICryptoHash#init()">init()</a></code> or <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsICryptoHash#initWithString()">initWithString()</a></code> has not been called.</dd>
</dl>

<h2 id="Example" name="Example">Example</h2>

<h3 id="Computing_the_Hash_of_a_File">Computing the Hash of a File</h3>

<p>You can easily compute the hash of a file using <code>nsICryptoHash</code>. You will need to create an instance of <code>nsICryptoHash</code>, open an input stream from a file, and then update the hash with the file. The following example shows how to compute the <code>SHA256</code> hash of a file:</p>

<pre class="brush: js">// hardcoded here for convenience
var path = "c:\\windows\\notepad.exe";
var f = Components.classes["@mozilla.org/file/local;1"]
                  .createInstance(Components.interfaces.nsILocalFile);
f.initWithPath(path);
var istream = Components.classes["@mozilla.org/network/file-input-stream;1"]
                        .createInstance(Components.interfaces.nsIFileInputStream);
// open for reading
istream.init(f, 0x01, 0444, 0);
var ch = Components.classes["@mozilla.org/security/hash;1"]
                   .createInstance(Components.interfaces.nsICryptoHash);
// we want to use the <code>SHA256</code> algorithm
ch.init(ch.<code>SHA256</code>);
// this tells updateFromStream to read the entire file
const PR_UINT32_MAX = 0xffffffff;
ch.updateFromStream(istream, PR_UINT32_MAX);
// pass false here to get binary data back
var hash = ch.finish(false);

// return the two-digit hexadecimal code for a byte
function toHexString(charCode)
{
  return ("0" + charCode.toString(16)).slice(-2);
}

// convert the binary hash data to a hex string.
var s = Array.from(hash, (c, i) =&gt; toHexString(hash.charCodeAt(i))).join("");
// s now contains your hash in hex
</pre>

<p>This gives <code>5eb63bbbe01eeed093cb22bb8f5acdc3</code> for the hash value. This example, while simple, shows most of the functionality of the interface.</p>

<p>The first thing to note is that when you call the <code><a href="#init">init()</a></code> method you must specify the hash algorithm to use. All of the available algorithms are specified as <a href="#Constants">constants</a> on the interface.</p>

<p>Also note that when you call the <code><a href="#updateFromStream">updateFromStream()</a></code> method, the second parameter is the number of bytes to read. Passing <code>PR_UINT32_MAX</code> here indicates that you want the entire file read.</p>

<p>Finally, note that calling the <code><a href="#finish">finish()</a></code> method produces the hash value. The single parameter to this method is <code>false</code> in this example to return binary data. Passing <code>true</code> returns the hash as a base 64 encoded string. In this example we take the binary data and produce a hexadecimal string of the result, as is commonly output by hashing programs.</p>

<h3 id="Computing_the_Hash_of_a_String">Computing the Hash of a String</h3>

<p>Another common operation is computing the hash value of a string. Since hash functions are computed over bytes, you will first need to convert the string to a series of bytes using <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIScriptableUnicodeConverter" title="">nsIScriptableUnicodeConverter</a></code> and a Unicode encoding that you specify.</p>

<p></p><div class="blockIndicator note"><strong>Note:</strong> Different encodings will produce different hash values! You should always use the same encoding if you intend to compare results.</div><p></p>

<p>The example below shows how to convert a string to bytes in the UTF-8 encoding, and then compute the <code>SHA256</code> hash of it. The result is computed as a hex string as in the previous example.</p>

<p>In this example, we use the <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsICryptoHash#update()">update()</a></code> method to pass an array of bytes to be hashed. As in the previous example, we convert the binary result to a hex string.</p>

<pre class="brush: js">var str = "hello world";
var converter =
  Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].
    createInstance(Components.interfaces.nsIScriptableUnicodeConverter);

// we use UTF-8 here, you can choose other encodings.
converter.charset = "UTF-8";
// result is an out parameter,
// result.value will contain the array length
var result = {};
// data is an array of bytes
var data = converter.convertToByteArray(str, result);
var ch = Components.classes["@mozilla.org/security/hash;1"]
                   .createInstance(Components.interfaces.nsICryptoHash);
ch.init(ch.<code>SHA256</code>);
ch.update(data, data.length);
var hash = ch.finish(false);

// return the two-digit hexadecimal code for a byte
function toHexString(charCode)
{
  return ("0" + charCode.toString(16)).slice(-2);
}

// convert the binary hash data to a hex string.
var s = Array.from(hash, (c, i) =&gt; toHexString(hash.charCodeAt(i))).join("");
// s now contains your hash in hex: should be
// 5eb63bbbe01eeed093cb22bb8f5acdc3
</pre>

<h2 id="See_also" name="See_also">See also</h2>

<ul>
 <li><a href="/en/Firefox_1.5_for_developers" title="en/Firefox_1.5_for_developers">Firefox 1.5</a></li>
</ul>