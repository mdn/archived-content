---
title: nsIZipReader
slug: Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader
tags:
  - Interfaces
  - 'Interfaces:Scriptable'
  - XPCOM
  - XPCOM API Reference
  - XPCOM Interface Reference
---
<p></p><div style="border: solid #ddd 2px; margin-bottom: 12px;">
<div style="background: #eee; padding: 2px;"><code><a href="https://dxr.mozilla.org/mozilla-central/source/modules/libjar/nsIZipReader.idl" rel="custom">modules/libjar/nsIZipReader.idl</a></code><span style="text-align: right; float: right;"><a href="/en-US/docs/Interfaces/About_Scriptable_Interfaces" style="color: #00cc00; font-weight: 700;">Scriptable</a></span></div>
<span style="padding: 4px 2px;">

This interface provides methods for reading compressed (zip) files.
</span>

<div style="background: #eee; padding: 2px;">
Inherits from: <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsISupports" title>nsISupports</a></code>
<span style="text-align: right; float: right;">Last changed in Gecko 10.0 (Firefox 10.0 / Thunderbird 10.0 / SeaMonkey 2.7)</span></div>
</div><p></p>

<p>Implemented by: <code>@mozilla.org/libjar/zip-reader;1</code>. To create an instance, use:</p>

<pre class="brush: js">var zipReader = Components.classes[&quot;@mozilla.org/libjar/zip-reader;1&quot;]
                .createInstance(Components.interfaces.nsIZipReader);
</pre>

<h2 id="About_character_sets_and_code_pages">About character sets and code pages</h2>

<div class="note notecard"><strong>Note:</strong> <code>nsIZipReader</code> has a code page problem; that is, in the ZIP specification, filenames are supposed to use 7-bit ASCII; however, most modern filesystems use 8 bit code pages, such as UTF-8. This can mismatch characters in the <code>nsIZipReader</code> API.</div>

<p>Starting in Gecko 10.0 (Firefox 10.0 / Thunderbird 10.0 / SeaMonkey 2.7), the <code>nsIZipReader</code> API supports a limited 8 bit code page usage. All functions now pass the filenames (both in and out) as <code>AUTF8String</code>. So you can now read and extract  what you wrote with <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipWriter" title>nsIZipWriter</a></code>. If you show filenames from the <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#findEntries()">findEntries()</a></code> result in the user interface,  the character matching is only fine on UTF-8  ZIP archives.</p>

<h2 id="Method_overview" name="Method_overview">Method overview</h2>

<table class="standard-table">
 <tbody>
  <tr>
   <td><code>void <a href="#close()">close</a>();</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#extract()">extract</a>(in AUTF8String zipEntry, in nsIFile outFile);</code> <br>
    <code>void <a href="#extract()">extract</a>(in string zipEntry, in nsIFile outFile);</code> <span class="obsolete obsoleteInline notecard inline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolete since Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>nsIUTF8StringEnumerator <a href="#findEntries()">findEntries</a>(in AUTF8String aPattern);</code> <br>
    <code>nsIUTF8StringEnumerator <a href="#findEntries()">findEntries</a>(in string aPattern);</code>  <span class="obsolete obsoleteInline notecard inline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolete since Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>nsIPrincipal <a href="#getCertificatePrincipal()">getCertificatePrincipal</a>(in AUTF8String aEntryName);</code> <br>
    <code>nsIPrincipal <a href="#getCertificatePrincipal()">getCertificatePrincipal</a>(in string aEntryName);</code>  <span class="obsolete obsoleteInline notecard inline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolete since Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>nsIZipEntry <a href="#getEntry()">getEntry</a>(in AUTF8String zipEntry); </code><br>
    <code>nsIZipEntry <a href="#getEntry()">getEntry</a>(in string zipEntry);</code> <span class="obsolete obsoleteInline notecard inline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolete since Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>nsIInputStream <a href="#getInputStream()">getInputStream</a>(in AUTF8String zipEntry); </code><br>
    <code>nsIInputStream <a href="#getInputStream()">getInputStream</a>(in string zipEntry);</code> <span class="obsolete obsoleteInline notecard inline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolete since Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>nsIInputStream <a href="#getInputStreamWithSpec()">getInputStreamWithSpec</a>(in AUTF8String aJarSpec, in AUTF8String zipEntry);</code> <br>
    <code>nsIInputStream <a href="#getInputStreamWithSpec()">getInputStreamWithSpec</a>(in AUTF8String aJarSpec, in string zipEntry);</code>  <span class="obsolete obsoleteInline notecard inline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolete since Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>boolean <a href="#hasEntry()">hasEntry</a>(in AUTF8String zipEntry);</code> </td>
  </tr>
  <tr>
   <td><code>void <a href="#init()">init</a>(in nsIFile zipFile);</code> <span class="obsolete obsoleteInline notecard inline" title="(Firefox 3)">Obsolete since Gecko 1.9</span></td>
  </tr>
  <tr>
   <td><code>void <a href="#open()">open</a>(in nsIFile zipFile);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#openInner()">openInner</a>(in nsIZipReader zipReader, in AUTF8String zipEntry);</code> <br>
    <code>void <a href="#openInner()">openInner</a>(in nsIZipReader zipReader, in string zipEntry);</code>  <span class="obsolete obsoleteInline notecard inline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolete since Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>void <a href="#test()">test</a>(in AUTF8String aEntryName);</code> <br>
    <code>void <a href="#test()">test</a>(in string aEntryName);</code> <span class="obsolete obsoleteInline notecard inline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolete since Gecko 10</span></td>
  </tr>
 </tbody>
</table>

<h2 id="Attributes" name="Attributes">Attributes</h2>

<table class="standard-table">
 <tbody>
  <tr>
   <td class="header">Attribute</td>
   <td class="header">Type</td>
   <td class="header">Description</td>
  </tr>
  <tr>
   <td><code>file</code></td>
   <td><code><code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFile">nsIFile</a></code></code></td>
   <td>The <code>file</code> that represents the zip with which this zip reader was initialized. <strong>Read only.</strong></td>
  </tr>
  <tr>
   <td><code>manifestEntriesCount</code></td>
   <td><code><a href="/en/PRUint32">PRUint32</a></code></td>
   <td>The number of entries in the manifest. <strong>Read only.</strong> </td>
  </tr>
 </tbody>
</table>

<h2 id="Methods" name="Methods">Methods</h2>

<h3 id="close()" name="close()">close()</h3>

<p>Closes a zip reader. Subsequent attempts to <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#extract()">extract()</a></code> files or read from its input stream will result in an error. Subsequent attempts to access a nsIZipEntry obtained from this zip reader will cause unspecified behavior.</p>

<pre class="eval">void close();
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<p>None.</p>

<div class="note notecard">
<p>Example demonstrating this function: <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#List_contents_of_XPI_and_read_file_contents">List Contents of XPI and Read File Contents</a></p>
</div>

<h3 id="extract()" name="extract()">extract()</h3>

<p>Extracts a zip entry into a local <code>file</code> specified by <code>outFile</code>. The entry must be stored in the zip in either uncompressed or DEFLATE-compressed format for the extraction to be successful. If the entry is a directory, the directory will be extracted non-recursively.</p>

<pre class="eval">void extract(
  in AUTF8String zipEntry,
  in nsIFile outFile
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipEntry</code></dt>
 <dd>The zip entry to extract.</dd>
 <dt><code>outFile</code></dt>
 <dd>The local file destination used to extract the zip entry.</dd>
</dl>

<p></p><h3 id="findEntries()">findEntries()</h3><p></p>

<p>Returns a string enumerator containing the matching entry names.</p>

<pre class="eval">nsIUTF8StringEnumerator findEntries(
  in AUTF8String aPattern
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aPattern</code></dt>
 <dd>A regular expression used to find matching entries in the zip <code>file</code>. Set this parameter to null (javascript) or EmptyCString() (c++) to get all entries; otherwise, use the following syntax:
 <ul>
  <li>* matches anything.</li>
  <li>? matches one character.</li>
  <li>$ matches the end of the string.</li>
  <li>[abc] matches one occurrence of a, b, or c. The only character that must be escaped inside the brackets is ]. ^ and - must never appear in the first and second positions within the brackets, respectively. (In the former case, the behavior specified for &apos;[^az]&apos; will happen.)</li>
  <li>[a-z] matches any character between a and z. The characters a and z must either both be letters or both be numbers, with the character represented by &apos;a&apos; having a lower ASCII value than the character represented by &apos;z&apos;.</li>
  <li>[^az] matches any character except a or z. If ] is to appear inside the brackets as a character to not match, it must be escaped.</li>
  <li>Pat~pat2 returns matches to the pattern &apos;pat&apos; which do not also match the pattern &apos;pat2&apos;. This may be used to perform filtering upon the results of one pattern to remove all matches which also match another pattern. For example, because &apos;*&apos; matches any string and &apos;*z*&apos; matches any string containing a &apos;z&apos;, &apos;*~*z*&apos; will match all strings except those containing a &apos;z&apos;. Note that a pattern may not use &apos;~&apos; multiple times, so a string such as &apos;*~*z*~*y*&apos; is not a valid pattern.</li>
  <li>(foo|bar) will match either the pattern foo or the pattern bar. Neither of the patterns foo or bar may use the &apos;pat~pat2&apos; syntax described immediately above.</li>
  <li>\ will escape a special character. Escaping is required for all special characters unless otherwise specified.</li>
  <li>All other characters match case-sensitively.</li>
 </ul>

 <p> </p>

 <p>An aPattern not conforming to this syntax has undefined behavior.</p>
 </dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>The <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIUTF8StringEnumerator" title>nsIUTF8StringEnumerator</a></code> containing the matching entry names.</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>NS_ERROR_ILLEGAL_VALUE</code></dt>
 <dd>On many but not all invalid <code>aPattern</code> values.</dd>
</dl>

<p></p><h3 id="getCertificatePrincipal()">getCertificatePrincipal()</h3><p></p>

<p>Returns an object describing the entity which signed an entry. parseManifest must be called first. If <code>aEntryName</code> is an entry in the jar, <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#getInputStream()">getInputStream()</a></code> must be called after parseManifest. If <code>aEntryName</code> is an external <code>file</code> which has meta-information stored in the jar, verifyExternalFile (not yet implemented) must be called before <code>getPrincipal</code>.</p>

<pre class="eval">nsIPrincipal getCertificatePrincipal(
  in string aEntryName
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aEntryName</code></dt>
 <dd>Missing Description</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>An <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIPrincipal" title>nsIPrincipal</a></code>.</p>

<div class="note notecard">
<p>Example demonstrating this function: <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#List_contents_of_XPI_and_read_file_contents">List Contents of XPI and Read File Contents</a></p>
</div>

<h3 id="getEntry()" name="getEntry()">getEntry()</h3>

<p>Returns a <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipEntry" title>nsIZipEntry</a></code> describing a specified zip entry.</p>

<pre class="eval">nsIZipEntry getEntry(
  in AUTF8String zipEntry
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipEntry</code></dt>
 <dd>The zip entry.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>The <code>nsIZipEntry</code> for the given zip entry.</p>

<div class="note notecard">
<p>Example demonstrating this function: <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#List_contents_of_XPI_and_read_file_contents">List Contents of XPI and Read File Contents</a></p>
</div>

<h3 id="getInputStream()" name="getInputStream()">getInputStream()</h3>

<p>Returns an input stream containing the contents of the specified zip entry.</p>

<pre class="eval">nsIInputStream getInputStream(
  in AUTF8String zipEntry
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipEntry</code></dt>
 <dd>The name of the entry to <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#open()">open()</a></code> the stream from.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>The <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIInputStream" title>nsIInputStream</a></code> containing the contents of the specified zip entry.</p>

<div class="note notecard">
<p>Example demonstrating this function: <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#List_contents_of_XPI_and_read_file_contents">List Contents of XPI and Read File Contents</a></p>
</div>

<p></p><h3 id="getInputStreamWithSpec()">getInputStreamWithSpec()</h3><p></p>

<p>Returns an input stream containing the contents of the specified zip entry. If the entry refers to a directory (ends with &apos;/&apos;), a directory stream is opened, otherwise the contents of the <code>file</code> entry is returned.</p>

<pre class="eval">nsIInputStream getInputStreamWithSpec(
  in AUTF8String aJarSpec,
  in AUTF8String zipEntry
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aJarSpec</code></dt>
 <dd>The Spec of the URI for the JAR (only used for directory streams).</dd>
 <dt><code>zipEntry</code></dt>
 <dd>The name of the entry to <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#open()">open()</a></code> the stream from.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>The <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIInputStream" title>nsIInputStream</a></code> containing the contents of the specified zip entry.</p>

<p></p><h3 id="hasEntry()">hasEntry()</h3><p></p>

<p>Checks whether the zipfile contains an entry specified by <code>zipEntry</code>.</p>

<pre class="eval">boolean hasEntry(
  in AUTF8String zipEntry
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipEntry</code></dt>
 <dd>The zip entry.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>Boolean value, <code>true</code> if the zip entry exists, <code>false</code> is it does not exist.</p>

<p></p><div class="headingWithIndicator">
        <h3 id="init()">init()</h3>
        <span class="obsolete obsoleteMethod notecard inline">Obsolete since Gecko 1.9 (Firefox 3)</span>
        </div><p></p>

<p>Initializes a zip reader after construction.</p>

<pre class="eval">void init(
  in nsIFile zipFile
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipFile</code></dt>
 <dd>Zip file to initialize.</dd>
</dl>

<h3 id="open()" name="open()">open()</h3>

<p>Opens a zip <code>file</code> for reading. It is allowed to <code>open</code> with another <code>file</code>, but it needs to be closed first with <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#close()">close()</a></code>.</p>

<p></p><div class="note notecard"><strong>Note:</strong> Prior to <span title="(Firefox 3)">Gecko 1.9</span> you first had to call <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#init()">init()</a></code>&quot;.&quot;</div><p></p>

<pre class="eval">void open(
  in nsIFile zipFile
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipFile</code></dt>
 <dd>The zip file to open.</dd>
</dl>

<div class="note notecard">
<p>Example demonstrating this function: <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#List_contents_of_XPI_and_read_file_contents">List Contents of XPI and Read File Contents</a></p>
</div>

<p></p><h3 id="openInner()">openInner()</h3><p></p>

<p>Opens a zip file inside a zip file for reading.</p>

<pre class="eval">void openInner(
  in nsIZipReader zipReader,
  in AUTF8String zipEntry
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt> </dt>
 <dt><code>zipReader</code></dt>
 <dd>The zipReader object.</dd>
 <dt><code>zipEntry</code></dt>
 <dd>The zip entry.</dd>
</dl>

<h3 id="test()" name="test()">test()</h3>

<p>Tests the integrity of the archive by performing a CRC check on each item expanded into memory. If an entry is specified the integrity of only that item is tested. If null (javascript) or EmptyCString() (c++) is passed in the integrity of all items in the archive are tested.</p>

<pre class="eval">void test(
  in AUTF8String aEntryName
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aEntryName</code></dt>
 <dd>The single entity to check or <code>null</code> for checking all entries in the archive.</dd>
</dl>

<h2 id="See_also" name="See_also">Examples</h2>

<h3 id="List_contents_of_XPI_and_read_file_contents">List contents of XPI and read file contents</h3>

<p>This example uses <code><a href="#findEntries()">findEntries</a></code>, <code><a href="#getEntry()">getEntry</a>, </code><code><a href="#getInputStream()">getInputStream</a></code>, <code><a href="#open()">open</a></code>, and <code><a href="#close()">close</a></code>. It also uses <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIScriptableInputStream">nsIScriptableInputStream</a> to read the stream returned by <code>getInputStream</code>. XPI files are ZIP files, just Firefox needs the extension to be XPI. Change &quot;<code>PortableTester@jetpack.xpi</code>&quot; to the name of a XPI file in your extensions folder. Then you can copy and paste this code in scratchpad to run it.</p>

<pre class="brush: js">    var zr = Cc[&quot;@mozilla.org/libjar/zip-reader;1&quot;].createInstance(Ci.nsIZipReader);
    Cu.import(&apos;resource://gre/modules/osfile.jsm&apos;);
    Cu.import(&apos;resource://gre/modules/FileUtils.jsm&apos;);

    var reusableStreamInstance = Cc[&apos;@mozilla.org/scriptableinputstream;1&apos;].createInstance(Ci.nsIScriptableInputStream);

    var pathToXpiToRead = OS.Path.join(OS.Constants.Path.profileDir, &apos;extensions&apos;, &apos;PortableTester@jetpack.xpi&apos;);
    var nsiFileXpi = new FileUtils.File(pathToXpiToRead);

    //Services.ww.activeWindow.alert(pathToXpiToRead);

    try {
      zr.open(nsiFileXpi); //if file dne it throws here
      var entries = zr.findEntries(&apos;*&apos;); //we use asterik because we want EVERYTHING listed out
      while (entries.hasMore()) {
        var entryPointer = entries.getNext(); //just a string of &quot;zip path&quot; (this means path to file in zip, and it uses forward slashes remember)
        var entry = zr.getEntry(entryPointer); // should return true on `entry instanceof Ci.nsIZipEntry`
        console.log(&apos;entryPointer&apos;, entryPointer);
        /* CONSOLE OUTPUT
         * &quot;entryPointer&quot; &quot;bootstrap.js&quot; Scratchpad/1:18
         */
        console.info(&apos;entry&apos;, entry);
        /* CONSOLE OUTPUT
         * &quot;entry&quot; XPCWrappedNative_NoHelper { QueryInterface: QueryInterface(), compression: Getter, size: Getter, realSize: Getter, CRC32: Getter, isDirectory: Getter, lastModifiedTime: Getter, isSynthetic: Getter, permissions: Getter, compression: 8 } Scratchpad/1:19
         */
        if (!entry.isDirectory) {
            var inputStream = zr.getInputStream(entryPointer);
            reusableStreamInstance.init(inputStream);
            var fileContents = reusableStreamInstance.read(entry.realSize);
            console.log(&apos;contenst of file=&apos;, fileContents);
        } else {
            console.log(&apos;is directory, no stream to read&apos;);
        }
      }
    } catch (ex) {
      console.warn(&apos;exception occured = &apos;, ex);
      if (ex.name == &apos;NS_ERROR_FILE_NOT_FOUND&apos;) {
        Services.ww.activeWindow.alert(&apos;XPI at path does not exist!\n\nPath = &apos; + pathToXpiToRead);
      }
    } finally {
      zr.close();
      console.log(&apos;zr closed&apos;);
    }</pre>

<h2 id="See_also" name="See_also">See also</h2>

<ul>
 <li><code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipEntry">nsIZipEntry</a></code></li>
 <li><code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipWriter">nsIZipWriter</a></code></li>
</ul>
