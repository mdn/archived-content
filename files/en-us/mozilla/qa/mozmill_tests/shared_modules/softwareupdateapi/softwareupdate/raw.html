
<p>The softwareUpdate class simplifies the access to the software dialog and some underlying backend functions. To run all the tests for a single update the browser has to be restarted in-between the tests.</p>
<h2 id="Method_overview">Method overview</h2>
<table class="standard-table"> <tbody> <tr> <td><code><a href="#softwareUpdate.28.29" title="#softwareUpdate.28.29">softwareUpdate</a>();<br> </code></td> </tr> <tr> <td><code><a href="#assertUpdateStep.28.29" title="#assertUpdateStep.28.29">assertUpdateStep</a>(in string step);<br> </code></td> </tr> <tr> <td><code><a href="#closeDialog.28.29" title="#closeDialog.28.29">closeDialog</a>();<br> </code></td> </tr> <tr> <td><code><a href="#download.28.29" title="#download.28.29">download</a>(in string updateType, in string channel, in number timeout);<br> </code></td> </tr> <tr> <td><code><a href="#forceFallback.28.29" title="#forceFallback.28.29">forceFallback</a>();<br> </code></td> </tr> <tr> <td><code><a href="#openDialog.28.29" title="#openDialog.28.29">openDialog</a>(in <a href="/en/Mozmill/Mozmill_Base_Object_Interfaces#mozmill.controller.MozMillController" title="en/Mozmill/Mozmill Base Object
            Interfaces#mozmill.controller.MozMillController">MozMillController</a> controller);<br> </code></td> </tr> <tr> <td><code><a href="#waitForCheckFinished.28.29" title="#waitForCheckFinished.28.29">waitForCheckFinished</a>(in number timeout);<br> </code></td> </tr> <tr> <td><code><a href="#waitForDialogOpen.28.29" title="#waitForDialogOpen.28.29">waitForDialogOpen</a>(in <a href="/en/Mozmill/Mozmill_Base_Object_Interfaces#mozmill.controller.MozMillController" title="en/Mozmill/Mozmill Base Object
            Interfaces#mozmill.controller.MozMillController">MozMillController</a> controller);</code></td> </tr> </tbody>
</table>
<h2 id="Attributes">Attributes</h2>
<table class="standard-table"> <thead> <tr> <th scope="col">Attribute</th> <th scope="col">Type</th> <th scope="col">Description</th> </tr> </thead> <tbody> <tr> <td><code>activeUpdate<br> </code></td> <td><code>{{ interface("nsIUpdate") }}<br> </code></td> <td>The currently active update.</td> </tr> <tr> <td><code>allowed<br> </code></td> <td><code>boolean<br> </code></td> <td><code>true</code> if the user is allowed to run a software update.</td> </tr> <tr> <td><code>currentStep<a name="currentStep"><br> </a></code></td> <td><code>string<br> </code></td> <td>The current step of the update dialog wizard. Possible values are <code>dummy</code>, <code>checking</code>, <code>noupdatesfound</code>, <code>incompatibleCheck</code>, <code>updatesfound</code>, <code>license</code>, <code>incompatibleList</code>, <code>downloading</code>, <code>errors</code>, <code>errorpatching</code>, <code>finished</code>, <code>finishedBackground</code>, <code>installed</code>.</td> </tr> <tr> <td><code>isCompleteUpdate<br> </code></td> <td><code>boolean<br> </code></td> <td><code>true</code> if the current update is a complete update.</td> </tr> <tr> <td><code>updateType<br> </code></td> <td><code>string<br> </code></td> <td>Type of the active update.</td> </tr> </tbody>
</table><h2 id="Methods">Methods</h2>
<h3 id="softwareUpdate.28.29" name="softwareUpdate.28.29">softwareUpdate()</h3>
<p>Constructor of the class.</p>
<pre>softwareUpdate();
</pre>
<h6 id="Parameters">Parameters</h6>
<p>None.</p>
<h3 id="assertUpdateStep.28.29" name="assertUpdateStep.28.29">assertUpdateStep()</h3>
<p>Assert that the current wizard state matches the given step.</p>
<pre><code>assertUpdateStep(<br>  in string step<br></code>);
</pre>
<h6 id="Parameters_2">Parameters</h6>
<dl> <dt><code>step</code></dt> <dd>Expected step of the SoftwareÂ Update wizard. For possible values, see <code><a href="#currentStep" title="#currentStep">currentStep</a></code>.</dd>
</dl>
<h3 id="closeDialog.28.29" name="closeDialog.28.29">closeDialog()</h3>
<p>Closes the software update dialog.</p>
<pre>closeDialog();
</pre>
<h6 id="Parameters_3">Parameters</h6>
<p>None.</p>
<h3 id="download.28.29" name="download.28.29">download()</h3>
<p>Downloads an update given its type and channel.</p>
<pre><code>download(<br>  in string updateType,<br>  in string channel,<br>  in number timeout</code>
);
</pre>
<h6 id="Parameters_4">Parameters</h6>
<dl> <dt><code>updateType</code></dt> <dd>Type of the update. Supported values are <code>minor</code> and <code>major</code>.</dd> <dt><code>channel</code></dt> <dd>Update channel to use to upgrade the application. Supported values are <code>nightly</code>, <code>beta</code>, <code>betatest</code>, <code>release</code>, and <code>releasetest</code>.</dd> <dt><code>timeout</code></dt> <dd>Maximum duration of the download. This parameter is optional. The default value is 6 minutes.</dd>
</dl>
<h3 id="forceFallback.28.29" name="forceFallback.28.29">forceFallback()</h3>
<p>Forces a fallback update by modifying the <code>update.status</code> file. Running {{ manch("download") }} again will cause a complete update to be downloaded.</p>
<pre>forceFallback();
</pre>
<h6 id="Parameters_5">Parameters</h6>
<p>None.</p>
<h3 id="openDialog.28.29" name="openDialog.28.29">openDialog()</h3>
<p>Opens the software update dialog.</p>
<pre><code>openDialog(<br>  in <a title="en/Mozmill/Mozmill Base Object
            Interfaces#mozmill.controller.MozMillController">MozMillController</a> controller</code>
);
</pre>
<h6 id="Parameters_6">Parameters</h6>
<dl> <dt><code>controller</code></dt> <dd><code>MozMillController</code> of the browser window.</dd>
</dl>
<h3 id="waitForCheckFinished.28.29" name="waitForCheckFinished.28.29">waitForCheckFinished()</h3>
<p>Waits until the check for new updates that happens when opening the software update dialog has completed.</p>
<pre>waitForCheckFinished(
  int number timeout
);
</pre>
<h6 id="Parameters_7">Parameters</h6>
<dl> <dt><code>timeout</code></dt> <dd>Maximum duration for the update check. The default value is 10 seconds.</dd>
</dl>
<h3 id="waitForDialogOpen.28.29" name="waitForDialogOpen.28.29">waitForDialogOpen()</h3>
<p>Waits until the software update dialog has been opened and initialized.</p>
<pre><code>waitForDialogOpen(<br>  in <a title="en/Mozmill/Mozmill Base Object
            Interfaces#mozmill.controller.MozMillController">MozMillController</a> controller</code>
);
</pre>
<h6 id="Parameters_8">Parameters</h6>
<dl> <dt><code>controller</code></dt> <dd><code>MozMillController</code> of the browser window.</dd>
</dl>
<h2 id="Examples">Examples</h2>
<pre class="brush: js">// Include necessary modules
var RELATIVE_ROOT = '../../../shared-modules';
var MODULE_REQUIRES = ['SoftwareUpdateAPI'];

var setupModule = function(module)
{
  module.controller = mozmill.getBrowserController();
  module.update = new SoftwareUpdateAPI.softwareUpdate();
}

var testUpdateDialog = function()
{
  // Open the dialog and wait until update check has been finished.
  update.openDialog(controller);
  update.waitForCheckFinished();

  // Check that an update is available
  update.assertUpdateStep('updatesfound');

  // Download the given type of update from the specified channel
  update.download(persisted.type, persisted.channel);

  // We should be ready for restart
  update.assertUpdateStep('finished');
}
</pre>